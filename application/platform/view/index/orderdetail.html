<!DOCTYPE html>
<html>
<head>
    <meta name="renderer" content="webkit"/>
    <meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/>
    <title>{$platformName}</title>

    <link rel="stylesheet" type="text/css" href="__STATIC__/blue/bootstrap/css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="__STATIC__/blue/css/ns_blue_common.css"/>
    <link rel="stylesheet" type="text/css" href="__STATIC__/font-awesome/css/font-awesome.min.css"/>
    <link rel="stylesheet" type="text/css" href="__STATIC__/simple-switch/css/simple.switch.three.css"/>
    <link rel="stylesheet" type="text/css" href="__STATIC__/blue/css/ns_table_style.css">
    <link rel="stylesheet" type="text/css" href="__STATIC__/admin/css/order.css">
    <link rel="stylesheet" type="text/css" href="__STATIC__/admin/css/jquery-ui-private.css">
    <script src="__STATIC__/js/jquery-1.8.1.min.js"></script>
    <script src="__STATIC__/blue/bootstrap/js/bootstrap.js"></script>
    <script src="__STATIC__/bootstrap/js/bootstrapSwitch.js"></script>
    <script src="__STATIC__/simple-switch/js/simple.switch.js"></script>
    <script src="__STATIC__/js/jquery.unobtrusive-ajax.min.js"></script>
    <script src="__STATIC__/js/common.js"></script>
    <script src="__STATIC__/js/seller.js"></script>
    <script src="__STATIC__/admin/js/jquery-ui.min.js"></script>
    <script src="__STATIC__/admin/js/ns_tool.js"></script>
    <script>
        var platform_shopname = "{$platformInfo.platform_site_name}";
    </script>
    <script src="__STATIC__/blue/js/ns_common_blue.js"></script>
    <style>
        .Switch_FlatRadius.On span.switch-open {
            background-color: #0072D2;
            border-color: #0072D2;
        }

        .silider-express {
            padding-left: 10px;
            background: #fff;
            font-size: 12px;
        }

        .logistics-tracking {
            padding-left: 5px;
        }

        .popover-content {
            width: 700px;
        }

        .popover {
            max-width: 900px;
        }

        .modal-body {
            max-height: none;
        }

        .editprice-input {
            width: 100px;
        }

        .pick_title {
            float: left;
            line-height: 32px;
            width: 140px;
            text-align: right;
        }

        .pick_title .required {
            color: red;
            margin-right: 10px;
        }

        textarea {
            width: 350px;
        }

        #pickup_name, #pickup_mobile {
            width: 350px;
        }

        .address_choice select {
            width: 118px
        }

        .modal-backdrop {
            background-color: #000000;
        }
        .zent-btn{
            margin-right: 6px;
        }
        .niu-money span{
            display: inline-block;
            width:150px;
        }
        .pick-info li{
            font-size:13px;
            color:#999;
        }
    </style>
</head>
<body>
{include file='index/head'/}
<div id="vue-main" v-cloak>
    <article class="ns-base-article">
        <aside class="ns-base-aside">
            {include file="index/nav_left"/}
            <nav>
                <ul>
                    <li class="selected" onclick="location.href='{:url('index/orderList')}';"
                        title="订单列表">订单列表
                    </li>
                </ul>
            </nav>
            <div style="height:50px;"></div>
            <div id="bottom_copyright">
                <footer>
                    <img id="copyright_logo"/>
                    <p>
                        <span id="copyright_desc"></span>
                        <br/>
                        <span id="copyright_companyname"></span>
                        <br/>
                        <span id="copyright_meta"></span>
                    </p>
                </footer>
            </div>
        </aside>
        <section class="ns-base-section">
            <!-- 操作提示 -->
            <div class="ns-warm-prompt" >
                <div class="alert alert-info">
                    <button type="button" class="close" onclick="$('.ns-warm-prompt').hide();">&times;</button>
                    <h4>
                        <i class="fa fa-bell"></i>
                        <span>操作提示</span>
                    </h4>
                    <div style="font-size:12px;text-indent:18px;">
                        订单详情
                    </div>
                </div>
            </div>
            <div style="position:relative;margin:10px 0;">
                <!-- 三级导航菜单 -->

                <nav class="ns-third-menu">
                    <ul>
                        <li class="selected">订单详情</li>
                    </ul>
                </nav>


                <div class="right-side-operation">
                    <ul>


                        <li style="display:none;"><a class="js-open-warmp-prompt"><i class="fa fa-info-circle"></i>&nbsp;提示</a>
                        </li>

                    </ul>
                </div>
            </div>
            <div class="ns-main">
                <div class="mod-table">
                    <div class="step-region clearfix">
                        <div class="info-region" style="width: 30%;">
                            <div class="info-div">订单信息<span class="secured-title">担保交易</span></div>
                            <table class="info-table">
                                <tbody>
                                <tr>
                                    <th>订单编号：</th>
                                    <td>{{orderInfo.order_no}}</td>
                                </tr>
                                <tr style="display: table-row;">
                                    <th>订单类型：</th>
                                    <td>普通订单</td>
                                </tr>
                                <tr>
                                    <th>付款方式：</th>
                                    <td>{{orderInfo.payment_type_name}}</td>
                                </tr>
                                <tr>
                                    <th>买家：</th>
                                    <td><span>{{orderInfo.user_name}}</span></td>
                                </tr>
                                </tbody>
                            </table>
                            <div class="dashed-line"></div>
                            <table class="info-table">
                                <tbody>
                                <tr>
                                    <th>配送方式：</th>
                                    <td>{{orderInfo.shipping_type_name}}</td>
                                </tr>
                                <!-- 物流 -->
                                <tr>
                                    <th>收货信息：</th>
                                    <td>
                                        <p>
                                            {{orderInfo.receiver_name}}，{{orderInfo.receiver_mobile}}，<span v-html="orderInfo.address"></span></p>
                                    </td>
                                </tr>
                                <tr>
                                    <th>买家留言：</th>
                                    <td>此订单没有留言</td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="state-region" style="width:70%;">
                            <div style="padding: 0px 0px 30px 40px;">
                                <div class="state-title"><span class="icon info">!</span>订单状态：{{orderInfo.pay_status_name}}
                                </div>
                                <div class="state-action">
                                    <button v-for="(item,index) in orderInfo.operation" class="zent-btn zent-btn-primary test-send-goods" @click="operation(item.no,item.id)">
                                        {{item.name}}
                                    </button>
                                </div>
                                <div style="border-top: 1px solid #ccc;margin-top: 20px;">
                                    <template v-if="orderInfo.shipping_type!=2">
                                    <h1 style="font-size:16px;padding-top: 0;">物流信息</h1>
                                    <ul class="list-group">
                                        <li class="list-group-item" v-if="expressInfo.trace.length==0">暂无物流信息</li>
                                        <li class="list-group-item" v-for="(item,index) in expressInfo.trace">{{index+1}}.{{item.AcceptTime}}&nbsp;&nbsp;&nbsp;&nbsp;{{item.AcceptStation}}</li>
                                    </ul>
                                    </template>
                                    <template v-else>
                                        <div style="width:45%;float: left;">
                                        <h1 style="font-size:16px;padding-top: 0;">自提点信息</h1>
                                        <ul class="list-group pick-info">
                                            <li class="list-group-item">名称：{{orderInfo.order_pickup.name}}</li>
                                            <li class="list-group-item">地址：{{orderInfo.order_pickup.province_name}}{{orderInfo.order_pickup.city_name}}{{orderInfo.order_pickup.district_name}}{{orderInfo.order_pickup.address}}</li>
                                            <li class="list-group-item">联系方式：{{orderInfo.order_pickup.phone}}</li>
                                        </ul>
                                        </div>
                                        <div style="width:45%;float: left;">
                                        <h1 style="font-size:16px;padding-top: 0;">自提人信息</h1>
                                        <ul class="list-group pick-info">
                                            <li class="list-group-item">姓名：{{orderInfo.order_pickup.buyer_name}}</li>
                                            <li class="list-group-item">联系方式：{{orderInfo.order_pickup.buyer_mobile}}</li>
                                            <li class="list-group-item">备注：{{orderInfo.order_pickup.remark}}</li>
                                        </ul>
                                        </div>

                                    </template>
                                </div>
                            </div>
                        </div>
                    </div>
                    <table class="ui-table ui-table-simple goods-table order-detail-goods-table">
                        <thead>
                        <tr>
                            <th style="width:8%;">商品图</th>
                            <th class="cell-10" style="width:40%;">商品</th>
                            <th style="width:10%;">价格(元)</th>
                            <th style="width:10%;">数量</th>
                            <th style="width:10%;">调整金额(元)</th>
                            <th class="cell-13" style="width:10%;">小计(元)</th>
                            <th style="width:15%;">状态</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- 待发货商品 -->
                        <tr class="test-item" v-for="(item,index) in orderInfo.order_goods">
                            <td class="td-goods-image" rowspan="1">
                                <div class="ui-centered-image" style="width: 48px; height: 48px;">
                                    <img :src="item.picture_info.pic_cover_micro"
                                         style="max-width: 48px; max-height: 48px;">
                                </div>
                            </td>
                            <td class="cell-10" style="width:200px;">
                                <a :href="'{:url('web/index/detail')}'+'&list='+item.goods_id" target="_blank">{{item.goods_name}}</a>
                                <p class="c-gray">{{item.sku_name}} </p>
                            </td>
                            <td>{{item.price}}</td>
                            <td>{{item.num}}</td>
                            <td>{{item.adjust_money}}</td>
                            <td><p>{{item.goods_money}}</p></td>
                            <td>
                                <p>{{item.shipping_status_name}}</p>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="9"></td>
                        </tr>
                        <!-- 已发货 -->
                        </tbody>
                        <tfoot>
                        <tr>
                            <td colspan="9" class="text-right niu-money">
                                <p><span>商品总金额：￥{{orderInfo.goods_money}}</span><span>运费：￥{{orderInfo.shipping_money}}</span><span>开票税金：￥{{orderInfo.tax_money}}</span></p>
                                <p><span>优惠抵扣：￥{{orderInfo.promotion_money}}</span><span>积分抵扣：￥{{orderInfo.point_money}}</span><span>抵用券抵扣：￥{{orderInfo.coupon_money}}</span></p>
                                <p><span>余额支付：￥{{orderInfo.user_platform_money}}</span><span style="color:red;width:300px;">实际需要支付金额：￥{{orderInfo.pay_money}}</span></p>
                                <p v-if="orderInfo.refund_money!=0">退款金额：￥{{orderInfo.refund_money}}</p>
                            </td>
                        </tr>
                        </tfoot>
                    </table>

                    <table class="ui-table ui-table-simple goods-table order-detail-goods-table"
                           style="border-top:none;">
                        <thead>
                        <tr>
                            <th>订单日志</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr class="test-item" colspan="9" v-for="item in orderInfo.order_action">
                            <td class="td-goods-image">
                                操作备注：&nbsp;&nbsp;&nbsp;{{item.user_name}}&nbsp;&nbsp;&nbsp;于&nbsp;&nbsp;&nbsp;{{item.update_time}}&nbsp;&nbsp;&nbsp;【{{item.action}}】
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </article>
</div>
<div id="dialog"></div>
<!-- 备注模态框（Modal） -->
<div class="modal fade hide" id="Memobox" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true"
     style="width:700px;left:45%;top:30%;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h3>备注信息</h3>
            </div>
            <div class="set-style">
                <dl>
                    <dt><span class="required">*</span>备注:</dt>
                    <dd>
                        <p>
                            <textarea rows="3" cols="20" id="memo"></textarea>
                        </p>
                        <p class="error">请输入备注</p>
                    </dd>
                </dl>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="addMemoAjax()">保存</button>
            </div>
        </div>
    </div>
</div>
<!-- 修改价格模态框（Modal） -->
<div id="edit-price" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="width: 650px;overflow: overlay;">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="margin-right: 10px;">×</button>
        <h3 id="H1">修改价格</h3>
    </div>
    <div class="modal-body">
        <table class="table table-striped table-main table-order-header">
            <colgroup>
                <col style="width: 40%;">
                <col style="width: 20%;">
                <col style="width: 25%;">
                <col style="width: 15%;">
            </colgroup>
            <tbody>
            <tr>
                <td>商品信息</td>
                <td>商品清单</td>
                <td>
                    <div class="editprice-tiptxt">涨价或减价<i class="icon-tip"></i>
                        <p class="text-tip">-表示减价<i class="icon-down-pic"></i></p>
                    </div>
                </td>
                <td>邮费</td>
            </tr>
            </tbody>
        </table>
        <table class="table table-bordered table-order-list">
            <colgroup>
                <col style="width: 40%;">
                <col style="width: 20%;">
                <col style="width: 25%;">
                <col style="width: 15%;">
            </colgroup>

            <tbody id="OrderCommodity"></tbody>
        </table>
        <ul class="edit-price-amountpay">
            <li>
                <span class="amountpay-label">商品总价：</span>
                <span class="amountpay-price" id="goodsmoney"></span>元&nbsp;&nbsp;&nbsp;
                <span class="amountpay-label">商品优惠：</span>
                <span class="amountpay-price" id="discountmoney"></span>元&nbsp;&nbsp;&nbsp;
                <span class="amountpay-label">运费：</span>
                <span class="amountpay-price" id="modifiedFreight"></span>元
            </li>
            <li>
                <div>
                    实收款： <span class="amountpay-price reality-price" id="changeTotal"></span>元
                    <input type="hidden" id="hiedchangeTotal" />
                </div>
            </li>
        </ul>
    </div>
    <div class="modal-footer">
        <button class="btn btn-primary" onclick="updPrice()" id="butSubmit" data-dismiss="modal" aria-hidden="true">保存</button>
        <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
    </div>
</div>
<script type="text/javascript" src="__STATIC__/vue/vue.js"></script>
<script type="text/javascript" src="__STATIC__/vue/vue-resource.js"></script>
<script type="text/javascript" src="__STATIC__/layer/layer.js"></script>
<script type="text/javascript" src="__STATIC__/layui/layui.js"></script>
<script>
    var vueMain;
    $(function () {
        vueMain = new Vue({
            el: "#vue-main",
            data: {
                orderInfo: {},
                expressInfo:{
                    is_express:0,
                    express_name:'',
                    trace:[]
                }
            },
            mounted: function () {
                this.$http.post("{:url('platform/Order/orderDetail')}", {order_id: '{$order_id}'},
                        {emulateJSON: true}).then(function (res) {
                    if (res.data.code == 0) {
                        this.orderInfo = res.data.data;
                        if(this.orderInfo.order_status>=2){
                            this.$http.post("{:url('Order/getExpressInfo')}", {express_id: this.orderInfo.goods_packet_list[0].express_id},
                                {emulateJSON: true}).then(function (res) {
                                if (res.data.code == 0) {
                                    this.expressInfo.is_express=1;
                                    this.expressInfo.express_name=this.orderInfo.goods_packet_list[0].express_name;
                                    this.expressInfo.trace=res.data.data.Traces;
                                }
                            });
                        }
                    }
                });
            },
            methods: {
                operation: function (operation_type, order_id) {
                    if (operation_type == 'pay') {
                        orderOffLinePay(order_id);//线下支付
                    } else if (operation_type == 'complete') {
                        orderComplete(order_id);//交易完成
                    } else if (operation_type == 'delivery') {
                        orderDelivery(order_id);//发货
                    } else if (operation_type == 'close') {
                        orderClose(order_id);//交易关闭
                    } else if (operation_type == 'adjust_price') {
                        modifyPrice(order_id);//修改价格
                    } else if (operation_type == 'pickup') {
                        pickuporder(order_id);//提货
                    } else if (operation_type == 'seller_memo') {
                        orderSellerMemo(order_id);//备注
                    } else if (operation_type == 'logistics') {
                        //查看物流
                        location.href = __URL(ADMINMAIN + '/order/orderdetail?order_id=' + order_id);
                    } else if (operation_type == 'update_address') {
                        update_address(order_id);//修改收货地址
                    } else if (operation_type == 'getdelivery') {
                        getdelivery(order_id);//确认收货
                    } else if (operation_type == 'delete_order') {
                        delete_order(order_id);//删除订单
                    }
                }
            },
            computed:{
                totalPrice:function(){
                    var price=parseFloat(this.orderInfo.goods_money)+parseFloat(this.orderInfo.shipping_money);
                    return price.toFixed(2);
                }
            }
        });
    });
    //线下交易
    function orderOffLinePay(order_id) {
        layer.confirm('确定线下支付吗？', {
            btn: ['确定','取消'] //按钮
        }, function(){
            $.ajax({
                type: "post",
                url: "{:url('platform/Order/orderOffLinePay')}",
                data: {order_id: vueMain.orderInfo.id},
                success: function (data) {
                    if (data["code"] == 0) {
                        layer.alert(data.msg,{title:"提示"},function(){
                            location.reload();
                        });
                    } else {
                        layer.alert(data.msg,{title:"提示"});
                    }
                }
            });
        });
    }

    //交易关闭
    function orderClose(order_id) {
        layer.confirm('确定关闭订单吗？', {
            btn: ['确定','取消'] //按钮
        }, function(){
            $.ajax({
                type: "post",
                url: "{:url('platform/Order/orderClose')}",
                data: {order_id: vueMain.orderInfo.id},
                success: function (data) {
                    if (data["code"] == 0) {
                        layer.alert(data.msg,{title:"提示"},function(){
                            location.reload();
                        });
                    } else {
                        layer.alert(data.msg,{title:"提示"});
                    }
                }
            })
        });
    }
    //获取订单备注
    function orderSellerMemo(order_id) {
        $.ajax({
            type: 'post',
            url: "{:url('platform/Order/getOrderSellerMemo')}",
            data: {order_id: vueMain.orderInfo.id},
            success: function (res) {
                vueMain.now_order_id=order_id;
//                $("#order_id").val(order_id);
                $("#memo").val(res.data);
                $("#Memobox").modal("show");
            }
        });
    }
    //修改备注
    function addMemoAjax(){
        var order_id = vueMain.orderInfo.id;
        var memo = $("#memo").val();
        if(memo == ''){
            $(".error").css("display","block");
            return false;
        }
        $("#Memobox").modal("hide");
        $.ajax({
            url: "{:url('platform/Order/addMemo')}",
            data: { order_id: order_id,memo:memo },
            type : "post",
            success: function(data) {
                if (data.code == 0) {
                   layer.msg(data.msg);
                }else{
                    layer.msg(data.msg);
                }
            }
        });
    }

    function modifyPrice(order_id,orderFreight){
//        vueMain.now_order_id=order_id;
        if(orderFreight == null){
            orderFreight = 0;
        }
        orderInfo ={
            express_fee: 0,
            total: 0,
            goodsArray: new Array()
        };
        $("#butSubmit").val(order_id);
        var str = "";
        var Total = 0.00;
        var Count = 0;
        $.ajax({
            type: "post",
            url: "{:url('platform/Order/getOrderGoods')}",
            data: { "order_id": vueMain.orderInfo.id },
            dataType: "json",
            async: false,
            success: function (res) {
                if(res.code==0){
                    jsonData=res.data;
                    var Subtotal = 0.0;
                    var order_info = jsonData[1];
                    jsonData = jsonData[0];
                    for (var i = 0 ; i < jsonData.length; i++) {
                        Price = (jsonData[i].price * 1);
                        Count = (jsonData[i].num * 1);
                        Subtotal = parseFloat(Price) * parseInt(Count);//单商品总价
                        Total += parseFloat(Subtotal * 1);
                        str += "<tr>";
                        str += "<td style='width:40%;'>";
                        str += "<div class='product-img'><img src='"+jsonData[i]['picture_info']['pic_cover_micro'] + "'></div>";
                        str += "<div class='product-infor'>";
                        //原总金额
                        var item_now_money = parseFloat(jsonData[i].price*jsonData[i].num)+parseFloat(jsonData[i].adjust_money);
                        str += "<input type='hidden' id='total"+jsonData[i].id+"' value='"+item_now_money*(item_now_money/parseFloat(jsonData[i].goods_money))+"'>";
                        str += "<a class='name'>" + jsonData[i].goods_name + "</a>";
                        if(jsonData[i].sku_name!='')
                            str += "<p class='specification'><span>规格:" + jsonData[i].sku_name + "</span></p>";
                        str += "<div class='div-flag-style'>";
                        str += "</div>";
                        str += "</div>";
                        str += "</td>";
                        str += "<td>";
                        str += "<div class='cell'><span name='Commoditymark' count='" + jsonData[i].num + "' id='" + jsonData[i].goods_id + "' dir='" + jsonData[i].price + "' value='" + jsonData[i].price + "'>￥" + jsonData[i].price + "</span></div>";
                        str += "<div class='cell' id='Count" + jsonData[i].goods_id + "' value='" + jsonData[i].num + "'>" + jsonData[i].num + "件</div>";
                        str += "</td>";
                        str += "<td>";
                        str += "<div class='editprice-discount'><input  type='hidden' id='productPrice" + jsonData[i].id + "' value='" + jsonData[i].price + "'><input type='hidden' id='count" + jsonData[i].goods_id + "' value='" + jsonData[i].num + "'>";
                        str += "<div class='editprice-minus'><input name='caculatePrice'  onchange=\"caculatePrice()\" id='" + jsonData[i].id + "' value='"+jsonData[i].adjust_money+"'  class='editprice-input price' type='number'  placeholder='0'  /></div>";
                        str += "</td>";
                        if (i == 0) {
                            str += "<td rowspan='"+jsonData.length+"'>";
                            str += "<input onchange=\"caculatePrice()\" id='Freightnumber' type='number' placeholder='0'  class='editprice-input' value='"+order_info.shipping_money+"' ";
                            if(orderFreight != 0 || orderFreight != ''){
                                str += orderFreight;
                            }
                            str += "' min='0'/>";
                            str += "<p class='muted'>直接输入邮费金额</p>";
                            str += "<input type='hidden' id='hidorderNumber' value='" + jsonData[i].order_id + "'>";
                            str += "<input type='hidden' id='freighthidden' value='" + orderFreight + "'>";
                            str += "<input type='hidden' id='goodsmoneyhidden' value=''>";
                            str += "<input type='hidden' id='favourable' value='0'>";
                            str += "</td>";
                            str += "</tr>";
                        }
                        $("#OrderCommodity").html(str);
                        $("#changeTotal").html(Total.toFixed(2));
                        $("#goodsmoney").html(order_info.goods_money);
                        $("#goodsmoneyhidden").val(Total);
                        var discount_money =order_info.point_money*1.00+order_info.coupon_money*1.00+order_info.user_money*1.00+order_info.promotion_money*1.00;
                        $("#discountmoney").html(discount_money);
                        $("#changeTotal").html(order_info.pay_money);
                        $("#hiedchangeTotal").html(Total);
                    }
                    $("#modifiedFreight").html(order_info.shipping_money);
                    var freight = $("#Freightnumber").val() == 0 ? 0 : $("#Freightnumber").val();
                    $('#edit-price').modal('show');
                }

            }
        });
    }
    //重新计算
    function caculatePrice(){
        //设置邮费
        if($("#Freightnumber").val() < 0 || $("#Freightnumber").val() == ''){
            showTip("邮费错误！","warning");
            return false;
        }
        var Freightnumber = $("#Freightnumber").val();//邮费input
        $("#modifiedFreight").html(Freightnumber);
        //调整金额
        var price = 0.00;
        $("input[name = 'caculatePrice']").each(function(i){
            if(0 == i){
                price = parseFloat($(this).val());
            }else{
                price = parseFloat($(this).val()) + parseFloat(price);
            }
        });
        var goods_money  = $("#goodsmoneyhidden").val();
        new_goods_money = (parseFloat(price)+parseFloat(goods_money)).toFixed(2);
        if(new_goods_money <0){
            $(".price").val(-goods_money);
            caculatePrice();
        }
        $("#goodsmoney").html(new_goods_money);
        // 获取邮费
        var modifiedFreight = $("#modifiedFreight").html();
        // 获取优惠金额
        var discountmoney = $("#discountmoney").html();
        //计算实收款
        new_hiedchangeTotal = (parseFloat(new_goods_money)+parseFloat(modifiedFreight)-parseFloat(discountmoney)).toFixed(2);
        $("#changeTotal").html(new_hiedchangeTotal);
    }

    //更新订单价格
    function updPrice(){
//        var order_id = vueMain.now_order_id;
        var order_goods_id_adjust_array = '';
        var shipping_fee = $("#Freightnumber").val();
        $("input[name = 'caculatePrice']").each(function(i){
            if(0 == i){
                order_goods_id_adjust_array = $(this).attr('id')+','+$(this).val();
            }else{
                order_goods_id_adjust_array += ';'+$(this).attr('id')+','+$(this).val();
            }
        });
        $.ajax({
            type: "post",
            url: "{:url('platform/Order/orderAdjustMoney')}",
            data: { "order_id": vueMain.orderInfo.id, "order_goods_id_adjust_array":order_goods_id_adjust_array, "shipping_fee":shipping_fee},
            dataType: "json",
            async: false,
            success: function (data) {
                if (data["code"] == 0) {
                    layer.alert(data.msg,{title:"提示"},function(){
                        location.reload();
                    })
                }else{
                    layer.alert(data.msg,{title:"提示"});
                }
            }
        });
    }

</script>
</body>
</html>