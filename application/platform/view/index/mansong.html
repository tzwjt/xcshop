
<!DOCTYPE html>
<html>
<head>
    <meta name="renderer" content="webkit" />
    <meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/>
    <title>{$platformName}</title>

    <link rel="stylesheet" type="text/css" href="__STATIC__/blue/bootstrap/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="__STATIC__/blue/css/ns_blue_common.css" />
    <link rel="stylesheet" type="text/css" href="__STATIC__/font-awesome/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="__STATIC__/simple-switch/css/simple.switch.three.css" />
    <link rel="stylesheet" type="text/css" href="__STATIC__/layui/css/layui.css">

    <style>
        .Switch_FlatRadius.On span.switch-open{background-color: #0072D2;border-color: #0072D2;}
    </style>
    <script src="__STATIC__/js/jquery-1.8.1.min.js"></script>
    <script src="__STATIC__/blue/bootstrap/js/bootstrap.js"></script>
    <script src="__STATIC__/bootstrap/js/bootstrapSwitch.js"></script>
    <script src="__STATIC__/simple-switch/js/simple.switch.js"></script>
    <script src="__STATIC__/js/jquery.unobtrusive-ajax.min.js"></script>
    <script src="__STATIC__/js/common.js"></script>
    <script src="__STATIC__/js/seller.js"></script>
    <script src="__STATIC__/admin/js/jquery-ui.min.js"></script>
    <script src="__STATIC__/admin/js/ns_tool.js"></script>
    <link rel="stylesheet" type="text/css" href="__STATIC__/blue/css/ns_table_style.css">
    <script src="__STATIC__/admin/js/My97DatePicker/WdatePicker.js" type="text/javascript"></script>
    <style>
        .set-style h4{color:#0072D2;margin-left:10px;}
        .table-div table tr td {border: 1px solid #e5e5e5;padding: 10px;}
        .goodlist-table tr td {border: 1px solid #e5e5e5;padding: 10px;}
        .help-inline {height: 30px;line-height: 30px;}
        input[type="radio"] {vertical-align: middle;margin-top: -2px;}
        .controls table tr td input[type="radio"] {margin: 0px;}
        .ump-select-search select {margin-bottom: 0px}
        .ump-select-tab {min-width: 750px;margin-bottom: -1px;background: #f2f2f2;border: 1px solid #ddd;border-bottom:0;}
        .ui-nav-tab {margin: 0;}
        .ui-nav-tab>li {position: relative;display: block;float: left;text-align: center;margin-bottom: -1px;}
        .ui-nav-tab:after {content: "";display: table;}
        .ump-select-tab .ui-nav-tab li.active a, .ump-select-tab .ui-nav-tab li.active a:hover{height: 24px;line-height: 24px;border-bottom: 2px solid #f60;}
        .ump-select-tab .ui-nav-tab li:first-child a {border-left: 0;}
        .ump-select-tab .ui-nav-tab li a {width: 120px;border-top: 0;height: 25px;line-height: 25px;padding: 8px 20px;}
        .ui-nav-tab>li.active>a, .ui-nav-tab>li.active>a:hover, .ui-nav-tab>li.active>a:focus{color: #333;background-color: #fff;border-bottom-color: transparent;cursor: default;}
        .ui-nav-tab>li>a {position: relative;display: block;padding: 9px 15px;margin-right: -1px;line-height: 1.42857143;border: 1px solid #ddd;background-color: #f8f8f8;color: #333;}
        .ump-select-box {width: 100%;border: 1px solid #ddd;overflow: hidden;}
        .ump-select-search {padding: 10px 20px 10px;border-bottom: 1px solid #ddd;position: relative;}
        .ump-select-goods .ui-table {background: #fff;}
        .ui-table.ui-table-list {border: none;}
        .ui-table {width: 100%;font-size: 12px;text-align: left;margin-bottom: 0;border: 1px solid #e5e5e5;}
        .ui-table th.checkbox, .ui-table td.checkbox {width: 18px;padding: 10px 0 10px 10px;}
        .ui-table th, .ui-table td {padding: 10px;border-bottom: 1px solid #e5e5e5;vertical-align: top;-webkit-box-sizing: border-box;-moz-box-sizing: border-box;box-sizing: border-box;}
        .ui-table th {background: #f8f8f8;}
        .ui-table .cell-20 {width: 20%;}
        .center, .text-center {text-align: center;}
        .ump-select-goods .ui-table tr td {padding: 6px 4px;border-bottom: 1px dashed #ddd;vertical-align: middle;}
        .ump-select-goods .goods-image-td, .ump-select-goods .goods-image-td .goods-image,.ump-select-goods .goods-image-td img {width: 30px;}
        .ui-box {margin-bottom: 15px;}
        .ump-select-footer {padding: 0 20px 0 10px;}
        .ump-select-footer .pull-left {padding-bottom: 20px;}
        .pull-left {float: left;}
        .pagenavi {font-size: 12px;line-height: 16px;text-align: right;}
        .ui-btn {display: inline-block;border-radius: 2px;height: 26px;line-height: 26px;padding: 0 12px;cursor: pointer;color: #333;background: #f8f8f8;border: 1px solid #ddd;text-align: center;font-size: 12px;-webkit-box-sizing: content-box;-moz-box-sizing: content-box;box-sizing: content-box;}
        .ui-toolt {position: relative;}
        .pagenavi .total, .pagenavi .prev, .pagenavi .next, .pagenavi .num,.pagenavi .goto-input, .pagenavi .goto-btn {display: inline-block;color: #333;}
        .pagenavi .total {padding: 6px 0;font-weight: normal !important;}
        .ui-table tr td {line-height: normal;}
        input[type=number] {-moz-appearance:textfield;}
        input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button {-webkit-appearance: none;margin: 0;}
        button{outline:none;}
        #pagelist input{
            width: 40px !important;
            height: 30px!important;
        }
    </style>

</head>
<body>
{include file="index/head"/}
<div id="vue-main" v-cloak>
<article class="ns-base-article">
    <aside class="ns-base-aside">
        {include file="index/nav_left"/}

        <nav>
            <ul>
                <li onclick="location.href='{:url('coupontypelist')}';" title="优惠券">优惠券</li>
                <li onclick="location.href='{:url('pointconfig')}';" title="积分管理">积分管理</li>
                <li class="selected" onclick="location.href='{:url('mansonglist')}';" title="满减送">满减送</li>
                <li onclick="location.href='{:url('getdiscountlist')}';" title="限时折扣">限时折扣</li>
                <li onclick="location.href='{:url('fullshipping')}';" title="满额包邮">满额包邮</li>
            </ul>
        </nav>
        <div style="height:50px;"></div>
        <div id="bottom_copyright">
            <footer>
                <img src="" id="copyright_logo"/>
                <p>
                    <span id="copyright_meta"></span>
                    <br/>
                    <span id="copyright_companyname"></span>
                    <br/>
                    <span id="copyright_desc"></span>
                </p>
            </footer>
        </div>
    </aside>
    <section class="ns-base-section">
        <!-- 操作提示 -->
        <div class="ns-warm-prompt" >
            <div class="alert alert-info">
                <button type="button" class="close" onclick="$('.ns-warm-prompt').hide();">&times;</button>
                <h4>
                    <i class="fa fa-bell"></i>
                    <span>操作提示</span>
                </h4>
                <div style="font-size:12px;text-indent:18px;">
                    {if condition="$mansong_id eq ''"}
                    添加满减满送
                    {else/}
                    编辑满减满送
                    {/if}
                </div>
            </div>
        </div>
        <div style="position:relative;margin:10px 0;">
            <!-- 三级导航菜单 -->
            <nav class="ns-third-menu">
                <ul>
                    <li class="selected">
                        {if condition="$mansong_id eq ''"}
                        添加满减满送
                        {else/}
                        编辑满减满送
                        {/if}
                    </li>
                </ul>
            </nav>
            <div class="right-side-operation">
                <ul>
                    <li style="display:none;"><a class="js-open-warmp-prompt"><i class="fa fa-bell"></i>提示</a></li>
                </ul>
            </div>
        </div>
        <div class="ns-main">

            <div class="set-style" style="margin:1em;">
                <h4>活动信息</h4>
                <dl>
                    <dt><span style="color:red;">*</span>&nbsp;&nbsp;活动名称:</dt>
                    <dd>
                        <input type="text" v-model="mansong.mansong_name" maxlength="10" class="input-common"/>
                        <p class="error">请输入活动名称</p>
                    </dd>
                </dl>
                <dl>
                    <dt><span style="color:red;">*</span>&nbsp;&nbsp;生效时间:</dt>
                    <dd>
                        <input v-model="mansong.start_time" class="input-medium input-common" type="text" id="start_time" style="width:250px;" onchange="changeTime()" onclick="WdatePicker({skin:'twoer',dateFmt:'yyyy-MM-dd HH:mm:ss'})" />
                        <span class="mlr5">至</span>
                        <input v-model="mansong.end_time" class="input-medium input-common" size="15"type="text" id="end_time" style="width:250px;" onchange="changeTime()" onclick="WdatePicker({skin:'twoer',dateFmt:'yyyy-MM-dd HH:mm:ss'})">
                        <p class="error">请输入生效时间</p>
                    </dd>
                </dl>

                <h4>优惠设置</h4>
                <dl>
                    <dt>优惠方式:</dt>
                    <dd>
                        <label><input class="input-mini" type="radio" name="type" value="1" v-model="mansong.type" @change="changeType()"/> 普通优惠</label>
                        <label><input class="input-mini" type="radio" name="type" value="2" v-model="mansong.type" @change="changeType()"/> 多级优惠</label>
                        <p class="hint">（每级优惠不累积叠加）</p>
                    </dd>
                </dl>
                <dl>
                    <dt><span style="color:red;">*</span>&nbsp;&nbsp;优惠条件:</dt>
                    <dd style="width:100%;">
                        <div class="table-responsive">
                            <table class="table">
                                <thead>
                                <tr>
                                    <th>层级</th>
                                    <th>优惠门槛</th>
                                    <th>优惠方式（可多选）</th>
                                    <th>操作</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="(item,index) in rule">
                                    <td>{{index+1}}</td>
                                    <td>满&nbsp;<input type="text" v-model="item.price" class="input-common" style="width:50px;vertical-align: middle;">&nbsp;元</td>
                                    <td>
                                        <div>
                                            <p>
                                                <label>
                                                    <input type="checkbox" name="mansong" class="discount1" v-model="item.is_discount"/>
                                                    <span v-if="!item.is_discount">减现金</span>
                                                    <span v-if="item.is_discount">减&nbsp;<input type="text" v-model="item.discount" class="input-common" style="width:50px;vertical-align:middle">&nbsp;元</span>
                                                </label>
                                            </p>
                                            <p>
                                                <label>
                                                    <input type="checkbox" name="mansong" v-model="item.free_shipping" class="free_shipping1" />
                                                    <span id="free_shipping1">免邮</span>
                                                </label>
                                            </p>
                                            <p>
                                                <label>
                                                    <input type="checkbox" name="mansong" class="give_point1" v-model="item.is_give_point"/>
                                                    <span v-if="!item.is_give_point">送积分</span>
                                                    <span v-if="item.is_give_point">送&nbsp;<input type="text" v-model="item.give_point" class="input-common" style="width:50px;vertical-align:middle">&nbsp;积分</span>
                                                </label>
                                            </p>
                                            <p>
                                                <label>
                                                    <input type="checkbox" name="mansong" class="give_coupon1" v-model="item.is_give_coupon"/>
                                                    <span v-if="!item.is_give_coupon">送优惠券</span>
                                                    <span v-if="item.is_give_coupon">送&nbsp;
                                                        <select class="select-common" v-model="item.give_coupon" @change="alertMsg()">
                                                            <option :value="item1.id" v-for="item1 in coupontypeList">{{item1.coupon_name}}</option>
                                                        </select>
                                                    </span>
                                                </label>
                                            </p>
                                            <p>
                                                <label>
                                                    <input type="checkbox" name="mansong" class="gift_id1" v-model="item.is_gift_id"/>
                                                    <span v-if="!item.is_gift_id">送赠品</span>
                                                    <span v-if="item.is_gift_id">送&nbsp;
                                                        <select class="select-common">

                                                        </select>
                                                    </span>
                                                </label>
                                            </p>
                                        </div>
                                    </td>
                                    <td></td>
                                </tr>
                                </tbody>
                                <tfoot v-if="mansong.type==2">
                                <tr>
                                    <td colspan="4">
                                        <a href="javascript:void(0)" style="color:#0072D2;" @click="addRule()">+新增一级优惠</a>
                                        <span class="gray pl20">最多可设置五个层级</span>
                                    </td>
                                </tr>
                                </tfoot>
                            </table>
                        </div>
                    </dd>
                </dl>

                <h4>选择活动商品</h4>
                <dl class="type_dl">
                    <!-- <dt>选择商品:</dt> -->
                    <dt style="text-align: right;width: 310px;"><span class="error" id="notSelect">请至少选择一件商品</span>
                    </dt>
                    <dd>
                        <label style="vertical-align: middle; font-weight: normal; display: inline-block;margin-right:5px;">
                            <input type="radio" value="1" name="range_type" v-model="mansong.range_type"/>
                            <span style="font-size: 15px; cursor: pointer;">所有商品</span>
                        </label>
                        <label style="vertical-align: middle; font-weight: normal; display: inline-block;">
                            <input type="radio" name="range_type" value="0" v-model="mansong.range_type">
                            <span style="cursor: pointer; font-size: 15px;">部分商品</span>
                        </label>
                    </dd>
                </dl>
                <dl>
                    <dd id="some_pro" style="width: 99%;" v-if="mansong.range_type==0">
                        <div class="js-goods-box">
                            <div class="ump-select-tab">
                                <ul class="ui-nav-tab">
                                    <li class="js-tab" :class="{active:show_good_type==1}"><a
                                            href="javascript:void(0);" @click="show_good_type=1">选择商品</a></li>
                                    <li class="js-tab" :class="{active:show_good_type==0}"><a
                                            href="javascript:void(0);" @click="show_good_type=0">已选商品</a></li>
                                </ul>
                            </div>
                            <div class="goods-list-wrap">
                                <div class="js-goods-list-region js-goods-list-tab select-one"
                                     v-if="show_good_type==1">
                                    <div class="widget-list">
                                        <div class="ump-select-box js-select-goods-list">
                                            <div class="ump-goods-wrap">
                                                <div class="ump-waitting-select ump-goods-list">
                                                    <div class="ump-select-goods">
                                                        <table class="ui-table ui-table-list" style="padding: 0px;">
                                                            <thead
                                                                    class="js-list-header-region tableFloatingHeaderOriginal">
                                                            <tr class="widget-list-header">
                                                                <th colspan="2">商品信息</th>
                                                                <th class="text-center cell-20 kucun">库存</th>
                                                                <th class="text-center cell-20">操作</th>
                                                            </tr>
                                                            </thead>
                                                            <tbody class="js-list-body-region goods-list">
                                                            <tr class="widget-list-item" v-for="(item,index) in goodsList">
                                                                <td class="goods-image-td text-center">
                                                                    <div class="goods-image js-goods-image"><img
                                                                            :src="item.pic_cover_micro">
                                                                    </div>
                                                                </td>
                                                                <td class="goods-meta"><p class="goods-title"><a
                                                                        :href="'{:url('web/index/detail')}'+'&list='+item.id"
                                                                        target="_blank" class="new-window">
                                                                    {{item.title}}
                                                                </a></p>
                                                                    <p class="goods-price">{{item.price}}</p></td>
                                                                <td class="text-center">{{item.total}}</td>
                                                                <td class="text-center goods-opt">
                                                                    <a href="javascript:;" class="btn btn-primary js-add-reward" @click="selectGood(item)" v-if="showGoodBtn(item.id)">参加活动</a>
                                                                    <a href="javascript:;" class="btn btn-default js-remove-reward" @click="delGood(item.id)" v-if="!showGoodBtn(item.id)">取消参加</a>
                                                                </td>
                                                            </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="js-selected-goods-list-region js-goods-list-tab select-two"
                                     v-if="show_good_type==0">
                                    <div>
                                        <div class="widget-list-item">
                                            <div class="ump-select-box js-select-goods-list">
                                                <div class="ump-goods-wrap">
                                                    <div class="ump-already-select ump-goods-list">
                                                        <div class="ump-select-goods">
                                                            <table class="ui-table ui-table-list js-table">
                                                                <thead class="js-list-header-region">
                                                                <tr>
                                                                    <th colspan="2">商品信息</th>
                                                                    <th class="cell-20 text-center kucun">库存</th>
                                                                    <th class="cell-20 text-center">操作</th>
                                                                </tr>
                                                                </thead>
                                                                <tbody class="js-list-body-region">
                                                                <tr class="widget-list-item" v-for="(item,index) in selectGoods">
                                                                    <td class="goods-image-td text-center">
                                                                        <div class="goods-image js-goods-image"><img
                                                                                :src="item.pic_cover_micro">
                                                                        </div>
                                                                    </td>
                                                                    <td class="goods-meta"><p class="goods-title"><a
                                                                            :href="'{:url('web/index/detail')}'+'&list='+item.id"
                                                                            target="_blank" class="new-window">
                                                                        {{item.title}}
                                                                    </a></p>
                                                                        <p class="goods-price">{{item.price}}</p></td>
                                                                    <td class="text-center">{{item.total}}</td>
                                                                    <td class="text-center goods-opt">
                                                                        <a href="javascript:;" class="btn btn-default js-remove-reward" @click="delGood(item.id)">取消参加</a>
                                                                    </td>
                                                                </tr>
                                                                </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </dd>
                </dl>
                <dl :style="{display:pageshow}">
                    <dt></dt>
                    <dd id="pagelist"></dd>
                </dl>
                <dl>
                    <dt></dt>
                    <dd><button class="btn-common btn-big" @click="addMansong();">提交</button></dd>
                </dl>
            </div>
        </div>
    </section>
</article>
</div>
<link rel="stylesheet" type="text/css" href="__STATIC__/admin/css/jquery-ui-private.css">
<script>
    var platform_shopname= '{$platformInfo.platform_site_name}';
</script>
<script type="text/javascript" src="__STATIC__/admin/js/jquery-ui-private.js" charset="utf-8"></script>
<script type="text/javascript" src="__STATIC__/admin/js/jquery.timers.js"></script>
<script type="text/javascript" src="__STATIC__/vue/vue.js"></script>
<script type="text/javascript" src="__STATIC__/vue/vue-resource.js"></script>
<script type="text/javascript" src="__STATIC__/layer/layer.js"></script>
<script type="text/javascript" src="__STATIC__/layui/layui.js"></script>
<script>
    var vueMain;
    $(function () {
        vueMain=new Vue({
            el:"#vue-main",
            data:{
                mansong:{
                    mansong_name:'',
                    start_time:'',
                    end_time:'',
                    type:1,
                    range_type:1,
                    rule:'',
                },
                rule:[],
                goodsList: [],
                show_good_type: 1,
                selectGoods:[],
                coupontypeList:[]
            },
            mounted:function () {
                this.getGoodsList();
                this.$http.post("{:url('platform/Promotion/getValidCouponTypeList')}", {},
                    {emulateJSON: true}).then(function (res) {
                    if (res.data.code == 0) {
                        this.coupontypeList=res.data.data.data;
                    }
                });
                if("{$mansong_id}"!=''){
                    this.$http.post("{:url('platform/Promotion/getMansongById')}", {mansong_id:"{$mansong_id}"},
                        {emulateJSON: true}).then(function (res) {
                        if (res.data.code == 0) {
                            this.mansong=res.data.data.mansong_info;
                            this.mansong.mansong_id=this.mansong.id;
                            for(i=0;i<res.data.data.mansong_info.goods_list.length;i++){
                                this.selectGoods.push({
                                    id:res.data.data.mansong_info.goods_list[i].goods_id,
                                    pic_cover_micro:res.data.data.mansong_info.goods_list[i].picture_info.pic_cover_micro,
                                    title:res.data.data.mansong_info.goods_list[i].title,
                                    price:res.data.data.mansong_info.goods_list[i].price,
                                    total:res.data.data.mansong_info.goods_list[i].total
                                });
                            }
                            for(i=0;i<res.data.data.mansong_info.rule.length;i++){
                                this.rule[i]={
                                    price:res.data.data.mansong_info.rule[i].price,
                                    is_discount:res.data.data.mansong_info.rule[i].discount==false?false:true,
                                    discount:res.data.data.mansong_info.rule[i].discount,
                                    free_shipping:res.data.data.mansong_info.rule[i].free_shipping==1?true:false,
                                    is_give_point:res.data.data.mansong_info.rule[i].give_point==false?false:true,
                                    give_point:res.data.data.mansong_info.rule[i].give_point,
                                    is_give_coupon:res.data.data.mansong_info.rule[i].give_coupon_id==false?false:true,
                                    give_coupon:res.data.data.mansong_info.rule[i].give_coupon_id,
                                    is_gift_id:res.data.data.mansong_info.rule[i].gift_id==false?false:true,
                                    gift_id:res.data.data.mansong_info.rule[i].gift_id
                                };

                            }
                            console.log(this.rule);

                        }
                    });
                }else{
                    this.addRule();
                }



            },
            methods:{
                addRule:function () {
                    if(this.rule.length>=5){
                        layer.alert("最多可设置五个层级",{icon:5});
                    }else{
                        this.rule.push({
                            price:'',
                            is_discount:false,
                            discount:'',
                            free_shipping:false,
                            is_give_point:false,
                            give_point:'',
                            is_give_coupon:false,
                            give_coupon:'',
                            is_gift_id:false,
                            gift_id:''
                        });
                    }
                },
                changeType:function () {
                    if(this.mansong.type==1){
                        if(this.rule.length>1)
                            this.rule.splice(1,this.rule.length-1);
                    }
                },
                getGoodsList: function (page) {
                    this.$http.post("{:url('platform/Goods/goodsList')}", {page_index: page, page_size: 10, status: 1},
                        {emulateJSON: true}).then(function (res) {
                        if (res.data.code == 0) {
                            this.goodsList = res.data.data.data;
                            layui.use(['laypage', 'layer'], function () {
                                var laypage = layui.laypage,layer= layui.layer;
                                laypage.render({
                                    elem: 'pagelist',
                                    count: res.data.data.total_count,
                                    limit:10,
                                    layout: ['count', 'prev', 'page', 'next', 'skip'],
                                    curr: page,
                                    jump: function (obj, first) {
                                        if (!first) {
                                            vueMain.getGoodsList(obj.curr);
                                        }
                                    }
                                });
                            });
                        }
                    });
                },
                selectGood:function(info){
                    for(i=0;i<this.selectGoods.length;i++){
                        if(this.selectGoods[i].id==info.id){
                            layer.alert("该商品已经添加，无需重复添加",{icon:5});
                            return;
                        }
                    }
                    this.selectGoods.push(info);
                    layer.alert("该商品添加成功",{icon:6});

                },
                delGood:function(id){
                    for(i=0;i<this.selectGoods.length;i++){
                        if(this.selectGoods[i].id==id){
                            this.selectGoods.splice(i,1);
                            layer.alert("该商品删除成功",{icon:6});
                            return;
                        }
                    }
                    layer.alert("很抱歉删除失败...",{icon:5});
                },
                showGoodBtn:function(id){
                    for(i=0;i<this.selectGoods.length;i++){
                        if(id==this.selectGoods[i].id){
                            return false;
                        }
                    }
                    return true;
                },
                addMansong:function () {
//                    this.mansong.start_time=$("#start_time").val();
//                    this.mansong.end_time=$("#end_time").val();

                    if(this.mansong.mansong_name==''){
                        layer.alert("请填写活动名称",{icon:5});
                        return;
                    }
                    if(this.mansong.start_time=='' || this.mansong.end_time==''){
                        layer.alert("请选择正确的生效时间",{icon:5});
                        return;
                    }
                    if(this.mansong.type==''){
                        layer.msg("请填写活动名称",{icon:5});
                        return;
                    }
                    this.mansong.rule='';
                    for(i=0;i<this.rule.length;i++){
                        if(this.rule[i].price==''){
                            layer.alert("请填写优惠门槛金额",{icon:5});
                            return;
                        }
                        if(this.rule[i].discount==false && this.rule[i].free_shipping==false && this.rule[i].give_point==false && this.rule[i].give_coupon==false && this.rule[i].gift_id==false){
                            layer.alert("请至少选择一种优惠条件",{icon:5});
                            return;
                        }
                        this.mansong.rule+=this.rule[i].price+","+this.rule[i].discount+","+(this.rule[i].free_shipping?1:0)+","+this.rule[i].give_point+","+this.rule[i].give_coupon+","+this.rule[i].gift_id;
                        if(i!=this.rule.length-1){
                            this.mansong.rule+=";";
                        }

                    }



                    this.mansong.goods_id_array='';
                    if(this.mansong.range_type!=1){
                        if(this.selectGoods.length==0){
                            layer.alert("当前优惠券使用于部分商品，至少需要选择一个商品",{icon:5});
                            return;
                        }else{
                            for(i=0;i<this.selectGoods.length;i++){
                                if(i==this.selectGoods.length-1){
                                    this.mansong.goods_id_array+=this.selectGoods[i].id;
                                }else{
                                    this.mansong.goods_id_array+=this.selectGoods[i].id+',';
                                }
                            }
                        }
                    }
                    if("{$mansong_id}"==''){
                        this.$http.post("{:url('platform/Promotion/addMansong')}", this.mansong,
                            {emulateJSON: true}).then(function (res) {
                            if (res.data.code == 0) {
                                layer.alert(res.data.msg,{icon:6},function(){
                                    location.href="{:url('mansonglist')}";
                                });
                            }else{
                                layer.alert(res.data.msg,{icon:5});
                            }
                        });
                    }else{
                        this.$http.post("{:url('platform/Promotion/updateMansong')}", this.mansong,
                            {emulateJSON: true}).then(function (res) {
                            if (res.data.code == 0) {
                                layer.alert(res.data.msg,{icon:6},function(){
                                    location.href="{:url('mansonglist')}";
                                });
                            }else{
                                layer.alert(res.data.msg,{icon:5});
                            }
                        });
                    }
                },
            },
            computed:{
                pageshow:function () {
                    if(this.mansong.range_type==0 && this.show_good_type==1){
                        return "block";
                    }else{
                        return "none";
                    }
                }
            }
        });
    });
    function changeTime(){
        vueMain.mansong.start_time=$("#start_time").val();
        vueMain.mansong.end_time=$("#end_time").val();

    }
</script>
</body>
</html>