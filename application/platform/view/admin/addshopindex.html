
<!DOCTYPE html>
<html>
<head>
    <meta name="renderer" content="webkit" />
    <meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/>
    <title>{$platformName}</title>
    <link rel="stylesheet" type="text/css" href="__STATIC__/blue/bootstrap/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="__STATIC__/blue/css/ns_blue_common.css" />
    <link rel="stylesheet" type="text/css" href="__STATIC__/font-awesome/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="__STATIC__/simple-switch/css/simple.switch.three.css" />
    <style>
        .Switch_FlatRadius.On span.switch-open{background-color: #0072D2;border-color: #0072D2;}
    </style>
    <script src="__STATIC__/js/jquery-1.8.1.min.js"></script>
    <script src="__STATIC__/blue/bootstrap/js/bootstrap.js"></script>
    <script src="__STATIC__/bootstrap/js/bootstrapSwitch.js"></script>
    <script src="__STATIC__/simple-switch/js/simple.switch.js"></script>
    <script src="__STATIC__/js/jquery.unobtrusive-ajax.min.js"></script>
    <script src="__STATIC__/js/common.js"></script>
    <script src="__STATIC__/js/seller.js"></script>
    <script src="__STATIC__/admin/js/jquery-ui.min.js"></script>
    <script src="__STATIC__/admin/js/ns_tool.js"></script>
    <link rel="stylesheet" type="text/css" href="__STATIC__/blue/css/ns_table_style.css">
    <script type="text/javascript" src="__STATIC__/My97DatePicker/WdatePicker.js"></script>
    <style>
        .p-label label{
            float: left;
            margin-right: 10px;
            margin-top: 5px;
            font-size:12px;
            color:#333;
        }
        .content p{
            margin-bottom: 10px!important;
        }
        .content-1 label{
            position: relative;
            top:10px;
        }
    </style>
    <script>
        UPLOADIMG='UPLOAD_SHOP_SITE';
        UPLOADVIDEO='UPLOAD_VIDEO';
    </script>
</head>
<body>
{include file='index/head'/}
<article class="ns-base-article" id="vue-main" v-cloak>
    <aside class="ns-base-aside">
        {include file='index/nav_left'/}
        <nav>
            <ul>
                <li class="selected" onclick="location.href='{:url('shopindexlist')}'" title="商城首页层">商城首页层</li>
                <li onclick="location.href='{:url('shopMenuList')}'" title="商城菜单">商城菜单</li>
                <li onclick="location.href='{:url('shopIntroduce')}'" title="商城介绍">商城介绍</li>
            </ul>
        </nav>
        <div style="height:50px;"></div>
        <div id="bottom_copyright">
            <footer>
                <img src="" id="copyright_logo"/>
                <p>
                    <span id="copyright_meta"></span>
                    <br/>
                    <span id="copyright_companyname"></span>
                    <br/>
                    <span id="copyright_desc"></span>
                </p>
            </footer>
        </div>
    </aside>
    <section class="ns-base-section">
        <!-- 操作提示 -->
        <div class="ns-warm-prompt" >
            <div class="alert alert-info">
                <button type="button" class="close">&times;</button>
                <h4>
                    <i class="fa fa-bell"></i>
                    <span>操作提示</span>
                </h4>
                <div style="font-size:12px;text-indent:18px;">
                    新建商城首页层
                </div>
            </div>
        </div>
        <div style="position:relative;margin:10px 0;">
            <!-- 三级导航菜单 -->
            <nav class="ns-third-menu">
                <ul>
                    <li class="selected">新建商城首页层</li>
                </ul>
            </nav>
        </div>
        <div class="ns-main">
            <div class="set-style">
                <dl>
                    <dt><span class="color-red">*</span>名称:</dt>
                    <dd>
                        <p><input name="UserCode" v-model="blockInfo.title" id="block_name" type="text" style="width:300px;" class="input-common"></p>
                    </dd>
                </dl>
                <dl>
                    <dt>应用于:</dt>
                    <dd>
                        <p class="p-label">
                            <label for="sort1" class="line-label"><input type="radio" value="1" v-model="blockInfo.sort" name="sort" id="sort1">手机端</label>
                            <label for="sort2" class="line-label"><input type="radio" value="2" v-model="blockInfo.sort" name="sort" id="sort2">PC端</label>
                        </p>
                    </dd>
                </dl>
                <dl>
                    <dt>类别:</dt>
                    <dd>
                        <p class="p-label">
                            <label for="type1" class="line-label"><input type="radio" value="1" v-model="blockInfo.type" name="type" id="type1">图片</label>
                            <label for="type2" class="line-label"><input type="radio" value="2" v-model="blockInfo.type" name="type" id="type2">视频</label>
                            <label for="type3" class="line-label"><input type="radio" value="3" v-model="blockInfo.type" name="type" id="type3">图片+视频</label>
                        </p>
                    </dd>
                </dl>
                <dl>
                    <dt><span class="color-red">*</span>层次:</dt>
                    <dd>
                        <p><input type="number" v-model="blockInfo.position" step="1" min="0" style="width:300px;" class="input-common"></p>
                    </dd>
                </dl>
                <dl>
                    <dt>是否启用:</dt>
                    <dd>
                        <p class="p-label">
                            <label for="is_use_1" class="line-label"><input type="radio" value="1" v-model="blockInfo.is_use" name="is_use" id="is_use_1">启用</label>
                            <label for="is_use_2" class="line-label"><input type="radio" value="0" v-model="blockInfo.is_use" name="is_use" id="is_use_2">暂停</label>
                        </p>
                    </dd>
                </dl>
                <!--<dl>-->
                    <!--<dt>&nbsp;</dt>-->
                    <!--<dd>-->
                        <!--<a @click="addContent()" style="font-size:18px;">新建内容组</a>-->
                    <!--</dd>-->
                <!--</dl>-->
                <dl v-for="(item,index) in blockInfo.content">
                    <dt>内容{{index+1}}：<br/><a @click="delBlock(index)">删除&nbsp;&nbsp;&nbsp;&nbsp;</a>
                    
                    </dt>
                    <dd clsss="content">
                        <p>名称：<input v-model="item.title" type="text" style="width:300px;" class="input-common"></p>
                        <p class="p-label content-1"><label>类型：</label>
                            <label :for="'item-type-'+index+'-1'" class="line-label"><input type="radio" value="image" v-model="item.type" :name="'item-type-'+index" :id="'item-type-'+index+'-1'">图片</label>
                            <label :for="'item-type-'+index+'-2'" class="line-label"><input type="radio" value="video" v-model="item.type" :name="'item-type-'+index" :id="'item-type-'+index+'-2'">视频</label>
                        </p>
                        <div class="upload-btn" style="float: left;margin-bottom: 10px;">
				<span>
					<input class="input-file" onchange="imgUpload(this)" :data-for-index="index" name="file_upload" :id="'uploadImg'+index" type="file">
				</span>
                            <p><i class="fa fa-cloud-upload"></i>上传图片</p>
                        </div>
                        <div style="clear:both;"></div>
                        <p>图片：<span v-if="item.image_position==''">暂无</span><img :src="item.image_position" v-if="item.image_position!=''" style="width:200px;"></p>
                        <template v-if="item.type=='video'">
                            <div style="clear:both;margin-bottom:20px;"></div>
                            <p style="margin-bottom: 1em;">代码：<textarea v-model="item.video_position" style="width:300px;height:150px;margin-bottom: 1em;" class="input-common"></textarea></p>
                        </template>
                        <p v-if="item.type=='image'">链接：<input v-model="item.link_url" type="text" style="width:300px;" placeholder="链接为空时，不跳转" class="input-common"></p>
                    </dd>
                </dl>
                <dl>
                    <dt></dt>
                    <dd>
                        <button class="btn-common btn-big" @click="addBlockAjax();">提交</button>
                        <button class="btn-common btn-big" @click="addContent();">新建内容</button>
                    </dd>
                </dl>
            </div>
        </div>
    </section>
</article>
<link rel="stylesheet" type="text/css" href="__STATIC__/admin/css/jquery-ui-private.css">
<script>
    var platform_shopname= '{$platformName}';
</script>
<script src="__STATIC__/js/ajax_file_upload.js" type="text/javascript"></script>
<script src="__STATIC__/js/file_upload.js" type="text/javascript"></script>

<script type="text/javascript" src="__STATIC__/admin/js/jquery-ui-private.js" charset="utf-8"></script>
<script type="text/javascript" src="__STATIC__/admin/js/jquery.timers.js"></script>
<script type="text/javascript" src="__STATIC__/vue/vue.js"></script>
<script type="text/javascript" src="__STATIC__/vue/vue-resource.js"></script>
<script type="text/javascript" src="__STATIC__/layer/layer.js"></script>
<script type="text/javascript" src="__STATIC__/layui/layui.js"></script>
<script>
    var vueMain;
    $(function () {
        vueMain=new Vue({
            el:"#vue-main",
            data:{
                blockInfo:{
                    // title:'',
                    // sort:1,
                    // type:1,
                    // position:0,
                    // is_use:1,
                    // content:[]
                },
            },
            mounted:function () {
                if("{$block_id}"!=''){
                    this.$http.post("{:url('platform/System/shopIndexBlockDetails')}", {block_id:'{$block_id}'},
                        {emulateJSON: true}).then(function (res) {
                        if (res.data.code == 0) {
                            this.blockInfo=res.data.data;
                            this.blockInfo.block_id=this.blockInfo.id;
                        }
                    });
                }else{
                    this.blockInfo={
                        title:'',
                            sort:1,
                            type:1,
                            position:0,
                            is_use:1,
                            content:[]
                    };
                    this.addContent();
                }
            },
            methods:{
                addContent:function () {
                    this.blockInfo.content.push({
                        title:'',
                        type:"image",
                        image_position:'',
                        video_position:'',
                        link_url:''
                    });
                },
                delBlock:function (index) {
                    this.blockInfo.content.splice(index,1);
                },
                addBlockAjax:function () {
                    if(this.blockInfo.title==''){
                        layer.alert("请填写标题",{icon:5});
                        return;
                    }
                   if(this.blockInfo.content.length==0){
                       layer.alert("请新建内容元素",{icon:5});
                       return;
                   }
                   for(i=0;i<this.blockInfo.content.length;i++){
                        if(this.blockInfo.content[i].title==''){
                            layer.alert("内容元素的标题不能为空",{icon:5});
                            return;
                        }
                       if(this.blockInfo.content[i].image_position==''){
                           layer.alert("请上传内容图片",{icon:5});
                           return;
                       }
                        if(this.blockInfo.content[i].type=='image'){
                            this.blockInfo.content[i].video_position='';
                        }else{
                            this.blockInfo.content[i].link_url='';
                        }




                       // if(this.blockInfo.content[i].link_url==''){
                       //     layer.alert("内容元素的链接不能为空",{icon:5});
                       //     return;
                       // }
                   }
                    if("{$block_id}"!=''){
                        this.$http.post("{:url('platform/System/updateShopIndexBlock')}", this.blockInfo,
                            {emulateJSON: true}).then(function (res) {
                            if (res.data.code == 0) {
                                layer.alert(res.data.msg,{icon:6},function () {
                                    location.href="{:url('shopindexlist')}";
                                });
                            }else{
                                layer.alert(res.data.msg,{icon:5});
                            }
                        });
                    }else{
                        this.$http.post("{:url('platform/System/addShopIndexBlock')}", this.blockInfo,
                            {emulateJSON: true}).then(function (res) {
                            if (res.data.code == 0) {
                                layer.alert(res.data.msg,{icon:6},function () {
                                    location.href="{:url('shopindexlist')}";
                                });
                            }else{
                                layer.alert(res.data.msg,{icon:5});
                            }
                        });
                    }

                }
            }
        });
    });
    //图片上传
    function imgUpload(event) {
        var index=$(event).attr("data-for-index");
        var fileid = $(event).attr("id");
        var data= {'file_path': UPLOADIMG};
        // if(vueMain.blockInfo.content[index].type=='image'){
        //     data = {'file_path': UPLOADIMG};
        // }else{
        //     data = {'file_path': UPLOADVIDEO};
        // }
        uploadFile(fileid, data, function (res) {
            if(res.code == 0) {
                // vueMain.userInfo.user_headimg=res.data;
                console.log(res.data);
                    vueMain.blockInfo.content[index].image_position=res.data;
                layer.alert(res.msg, {icon: 6, title: '提示'});
            } else {
                // vueMain.userInfo.user_headimg='';
                    vueMain.blockInfo.content[index].image_position='';
                layer.alert("上传失败", {icon: 5, title: '提示'});
            }
            console.log(vueMain.blockInfo);
        }, "{:url('util/img_upload/uploadFile')}");
    }
</script>
</body>
</html>