
<!DOCTYPE html>
<html>
<head>
    <meta name="renderer" content="webkit" />
    <meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/>
    <title>{$platformName}</title>
    <link rel="stylesheet" type="text/css" href="__STATIC__/blue/bootstrap/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="__STATIC__/blue/css/ns_blue_common.css" />
    <link rel="stylesheet" type="text/css" href="__STATIC__/font-awesome/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="__STATIC__/simple-switch/css/simple.switch.three.css" />
    <style>
        .Switch_FlatRadius.On span.switch-open{background-color: #0072D2;border-color: #0072D2;}
    </style>
    <script src="__STATIC__/js/jquery-1.8.1.min.js"></script>
    <script src="__STATIC__/blue/bootstrap/js/bootstrap.js"></script>
    <script src="__STATIC__/bootstrap/js/bootstrapSwitch.js"></script>
    <script src="__STATIC__/simple-switch/js/simple.switch.js"></script>
    <script src="__STATIC__/js/jquery.unobtrusive-ajax.min.js"></script>
    <script src="__STATIC__/js/common.js"></script>
    <script src="__STATIC__/js/seller.js"></script>
    <script src="__STATIC__/admin/js/jquery-ui.min.js"></script>
    <script src="__STATIC__/admin/js/ns_tool.js"></script>
    <link rel="stylesheet" type="text/css" href="__STATIC__/blue/css/ns_table_style.css">
    <style>
        .user_type label{
            vertical-align: middle;
            margin: 0 5px 0 0;
            display: inline-block;
            font-weight: normal
        }
        .user_type input{
            margin:0;
        }
        .is_btn {
            display: inline-block;
            height: 30px;
            width: 44px;
            text-align: center;
            background-color: #ECF0F1;
            border-color: #BEC3C7;
            color: #777;
            cursor: pointer;
        }

        .is_btn_yes {
            border-radius: 4px 0 0 4px;
            border-width: 1px 0 1px 1px;
        }

        .is_btn_no {
            border-radius: 0 4px 4px 0;
            border-width: 1px 1px 1px 0;
        }

        .is_btn_yes.active {
            background-color: #0072D2;
            border-color: #0072D2;
            color: #fff;
        }

        .is_btn_no.active {
            color: #FFF;
            background-color: #96A6A6;
            border-color: #808B8D;
        }
    </style>
</head>
<body>
{include file='index/head'/}
<article class="ns-base-article" id="vue-main" v-cloak>
    <aside class="ns-base-aside">
        {include file='index/nav_left'/}
        <nav>
            <ul>
                <li onclick="location.href='{:url('admin/expresscompany')}';" title="物流配送">物流配送</li>
                <li onclick="location.href='{:url('admin/platformShop')}';" title="平台体验店">平台体验店</li>
                <li onclick="location.href='{:url('admin/webconfig')}';" title="基础设置">基础设置</li>
                <li onclick="location.href='{:url('admin/picconfig')}';" title="图片设置">图片设置</li>
                <li onclick="location.href='{:url('admin/agentwithdrawsetting')}';" title="代理商提现设置">代理商提现设置</li>
                <li class="selected" onclick="location.href='{:url('admin/notifyindex')}';" title="通知设置">通知设置</li>
                <li onclick="location.href='{:url('admin/customservice')}';" title="客服设置">客服设置</li>
                <li onclick="location.href='{:url('admin/paylist')}';" title="支付设置">支付设置</li>
                <li onclick="location.href='{:url('admin/originalroadrefundsetting')}';" title="原路退回配置">原路退回配置</li>
            </ul>
        </nav>
    </aside>
    <section class="ns-base-section">
        <!-- 操作提示 -->
        <div class="ns-warm-prompt" >
            <div class="alert alert-info">
                <button type="button" class="close">&times;</button>
                <h4>
                    <i class="fa fa-bell"></i>
                    <span>操作提示</span>
                </h4>
                <div style="font-size:12px;text-indent:18px;">
                    邮件通知系统
                </div>
            </div>
        </div>
        <div style="position:relative;margin:10px 0;">
            <!-- 三级导航菜单 -->

            <nav class="ns-third-menu">
                <ul>
                    <li class="selected">邮件通知设置</li>
                </ul>
            </nav>
        </div>
        <div class="ns-main">
            <!-- 邮箱设置 -->
            <div class="set-style">
                <dl>
                    <dt>是否开启：</dt>
                    <dd>
                        <span class="is_btn is_btn_yes" :class="{active:emailInfo.is_use==1}" @click="checkUse('is_use')">是</span><span class="is_btn is_btn_no" :class="{active:emailInfo.is_use==0}" @click="checkUse('is_use')">否</span>
                    </dd>
                </dl>
                <dl>
                    <dt>SMTP服务器：</dt>
                    <dd>
                        <input id="email_host" type="text" v-model="emailInfo.email_host" class="input-common" />
                    </dd>
                </dl>
                <dl>
                    <dt>SMTP端口：</dt>
                    <dd>
                        <input id="email_port" type="text" v-model="emailInfo.email_port" class="input-common" />
                    </dd>
                </dl>
                <dl>
                    <dt>发信人邮件地址：</dt>
                    <dd>
                        <input id="email_addr" type="text" v-model="emailInfo.email_addr" class="input-common" />
                    </dd>
                </dl>
                <dl>
                    <dt>SMTP身份验证用户名：</dt>
                    <dd>
                        <input id="email_id" type="text" v-model="emailInfo.email_id" class="input-common" />
                    </dd>
                </dl>
                <dl>
                    <dt>SMTP身份验证码：</dt>
                    <dd>
                        <input id="email_pass" type="text" v-model="emailInfo.email_pass" class="input-common" />
                    </dd>
                </dl>
                <dl>
                    <dt>是否使用安全链接：</dt>
                    <dd>
                        <span class="is_btn is_btn_yes" :class="{active:emailInfo.email_is_security==1}" @click="checkUse('email_is_security')">是</span><span class="is_btn is_btn_no" :class="{active:emailInfo.email_is_security==0}" @click="checkUse('email_is_security')">否</span>
                    </dd>
                </dl>
                <dl>
                    <dt>测试接收邮件地址：</dt>
                    <dd>
                        <input id="email_test" type="text"/>
                        <button class="btn-common" @click="testSend()">测试发送</button>
                    </dd>
                </dl>
                <dl>
                    <dt></dt>
                    <dd><button class="btn-common btn-big" @click="ajaxSubmit();">提交</button></dd>
                </dl>
            </div>
        </div>
    </section>
</article>
<link rel="stylesheet" type="text/css" href="__STATIC__/admin/css/jquery-ui-private.css">
<script>
    var platform_shopname= '{$platformName}';
</script>
<script type="text/javascript" src="__STATIC__/admin/js/jquery-ui-private.js" charset="utf-8"></script>
<script type="text/javascript" src="__STATIC__/admin/js/jquery.timers.js"></script>
<script type="text/javascript" src="__STATIC__/vue/vue.js"></script>
<script type="text/javascript" src="__STATIC__/vue/vue-resource.js"></script>
<script type="text/javascript" src="__STATIC__/layer/layer.js"></script>
<script type="text/javascript" src="__STATIC__/layui/layui.js"></script>
<script>
    var vueMain;
    $(function () {
        vueMain=new Vue({
            el:"#vue-main",
            data:{
                emailInfo:{}
            },
            mounted:function () {
                this.$http.post("{:url('platform/Config/messageConfig')}", {},
                    {emulateJSON: true}).then(function (res) {
                    if (res.data.code == 0) {
                        this.emailInfo={
                            is_use:res.data.data.email_message.is_use,
                            email_addr:res.data.data.email_message.value.email_addr,
                            email_host:res.data.data.email_message.value.email_host,
                            email_id:res.data.data.email_message.value.email_id,
                            email_is_security:res.data.data.email_message.value.email_is_security,
                            email_pass:res.data.data.email_message.value.email_pass,
                            email_port:res.data.data.email_message.value.email_port
                        };
                    }
                });
            },
            methods: {
                ajaxSubmit:function () {
                    this.$http.post("{:url('platform/Config/setEmailMessage')}", this.emailInfo,
                        {emulateJSON: true}).then(function (res) {
                        if (res.data.code == 0) {
                            layer.alert(res.data.msg,{icon:6},function () {
                                location.reload();
                            });
                        }else{
                            layer.alert(res.data.msg,{icon:5});
                        }
                    });
                },
                checkUse:function (name) {
                    if(name=='is_use'){
                        this.emailInfo.is_use=this.emailInfo.is_use==1?0:1;
                    }
                    if(name=='email_is_security'){
                        this.emailInfo.email_is_security=this.emailInfo.email_is_security==1?0:1;
                    }
                },
                testSend:function () {
                    var email_test=$("#email_test").val();
                    if(email_test==''){
                        layer.alert("你先填写测试接收邮件地址",{icon:5});
                        return;
                    }
                    layer.confirm('你确定要发送测试邮件吗？', {
                        btn: ['确定','取消'] //按钮
                    }, function(){
                        vueMain.$http.post("{:url('platform/Config/testSend')}", {
                                'email_host':vueMain.emailInfo.email_host,
                                'email_port':vueMain.emailInfo.email_port,
                                'email_addr':vueMain.emailInfo.email_addr,
                                'email_id':vueMain.emailInfo.email_id,
                                'email_pass':vueMain.emailInfo.email_pass,
                                'email_is_security':vueMain.emailInfo.email_is_security,
                                'email_test':$("#email_test").val()
                            },
                            {emulateJSON: true}).then(function (res) {
                            if (res.data.code == 0) {
                                layer.alert(res.data.msg,{icon:6});
                            }else{
                                layer.alert(res.data.msg,{icon:5});
                            }
                        });
                    });
                }
            }
        });
    });
</script>

</body>
</html>