<!DOCTYPE html>
<html>
<head>
    <meta name="renderer" content="webkit"/>
    <meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"/>
    <title>{$platformName}</title>
    <link rel="stylesheet" type="text/css" href="__STATIC__/blue/bootstrap/css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="__STATIC__/blue/css/ns_blue_common.css"/>
    <link rel="stylesheet" type="text/css" href="__STATIC__/font-awesome/css/font-awesome.min.css"/>
    <link rel="stylesheet" type="text/css" href="__STATIC__/simple-switch/css/simple.switch.three.css"/>
    <style>
        .Switch_FlatRadius.On span.switch-open {
            background-color: #0072D2;
            border-color: #0072D2;
        }
    </style>
    <script src="__STATIC__/js/jquery-1.8.1.min.js"></script>
    <script src="__STATIC__/blue/bootstrap/js/bootstrap.js"></script>
    <script src="__STATIC__/bootstrap/js/bootstrapSwitch.js"></script>
    <script src="__STATIC__/simple-switch/js/simple.switch.js"></script>
    <script src="__STATIC__/js/jquery.unobtrusive-ajax.min.js"></script>
    <script src="__STATIC__/js/common.js"></script>
    <script src="__STATIC__/js/seller.js"></script>
    <script src="__STATIC__/admin/js/jquery-ui.min.js"></script>
    <script src="__STATIC__/admin/js/ns_tool.js"></script>
    <link rel="stylesheet" type="text/css" href="__STATIC__/blue/css/ns_table_style.css">


    <style>
        .Switch_FlatCircular {
            line-height: 30px;
        }

        .left_main {
            width: 23%;
            float: left;
            border: 1px solid #E3E3E3;
            height: 524px;
        }

        .left_main ul {
            margin: 10px;
        }

        .leftcheckbox {
            float: right;
        }

        .left_main li {
            line-height: 30px;
            padding: 2px 6px;
            border: 1px dotted #E3E3E3;
            margin-bottom: 10px;
        }

        .left_main ul a {
            color: #666;
        }

        .left_main a:hover {
            color: #11B9ED;
        }

        .right_main {
            width: 75%;
            float: right;
            border: 1px solid #E3E3E3;
            height: 400px;
        }

        .main-top {
            height: 30px;
            line-height: 30px;
            padding: 0 10px;
            color: #666;
            border-bottom: 1px solid #E3E3E3;
            margin-bottom: 15px;
        }

        .email_title {
            width: 81px;
            line-height: 40px;
            float: left;
            padding-left: 10px;
        }

        .edit_bat {
            width: 250px;
            float: left;
            margin-left: 20px;
            line-height: 40px;
        }

        .save {
            clear: both;
            text-align: center;
            margin-top: 10px;
            display: inline-block;
            width: 100%;
        }

        input[type="submit"], input.submit, a.submit {
            display: inline-block;
        }

        .back {
            background: #e5e5e5;
            border: 0;
            height: 30px;
            width: 66px;
        }

        .rightlist {
            clear: both;
            content: '';
            display: inline-block;
        }

        .right-item {
            width: 12%;
        }

        .itemlist {
            padding: 0 2px;
            margin: 5px;
            float: left;
            text-align: center;
            color: #666;
        }

        .title-item {
            height: 40px;
            border-top: 1px solid #E3E3E3;
            color: #666;
        }

        .template-message {
            height: 40px;
            line-height: 40px;
            border: 1px solid #e5e5e5;
            border-bottom: none;
        }

        h1 {
            width: 2px;
            height: 20px;
            float: left;
            background-color: #0072D2;
        }

        a.active .niu-title {
            color: #11B9ED !important;
        }

        .tab-pane {
            clear: both;
            content: '';
        }

        .msg {
            display: inline-block;
            width: 100%;
            color: #FF8400;
            height: 40px;
            line-height: 40px;
            padding-left: 10px;
        }

        .senditem {
            border: 1px solid #11B9ED;
            margin: 9px;
            border-radius: 3px;
            width: 30%;
        }

        .qianming {
            display: inline-block;
            line-height: 40px;
            margin-left: 10px;
            color: #666;
            width: 100%;
        }

        .bl {
            color: #666;
            margin-left: 10px;
            display: inline-block;
            line-height: 35px;
            width: 100%;
        }

        input[type="text"] {
            vertical-align: middle;
            margin-bottom: 0;
        }

        .btn-common, .btn-common-cancle {
            margin: 15px 0 5px 226px !important;
        }

        .user_type label {
            vertical-align: middle;
            margin: 0 5px 0 0;
            display: inline-block;
            font-weight: normal
        }

        .user_type input {
            margin: 0;
        }

        .is_btn {
            display: inline-block;
            height: 30px;
            width: 44px;
            text-align: center;
            background-color: #ECF0F1;
            border-color: #BEC3C7;
            color: #777;
            cursor: pointer;
        }

        .is_btn_yes {
            border-radius: 4px 0 0 4px;
            border-width: 1px 0 1px 1px;
        }

        .is_btn_no {
            border-radius: 0 4px 4px 0;
            border-width: 1px 1px 1px 0;
        }

        .is_btn_yes.active {
            background-color: #0072D2;
            border-color: #0072D2;
            color: #fff;
        }

        .is_btn_no.active {
            color: #FFF;
            background-color: #96A6A6;
            border-color: #808B8D;
        }

        .niu-li {
            color: #666;
        }

        .left_main li.active {
            border-color: #0e80e1;
        }
    </style>

</head>
<body>
{include file='index/head'/}
<article class="ns-base-article" id="vue-main" v-cloak>
    <aside class="ns-base-aside">
        {include file='index/nav_left'/}
        <nav>
            <ul>
                <li onclick="location.href='{:url('admin/expresscompany')}';" title="物流配送">物流配送</li>
                <li onclick="location.href='{:url('admin/platformShop')}';" title="平台体验店">平台体验店</li>
                <li onclick="location.href='{:url('admin/webconfig')}';" title="基础设置">基础设置</li>
                <li onclick="location.href='{:url('admin/picconfig')}';" title="图片设置">图片设置</li>
                <li onclick="location.href='{:url('admin/agentwithdrawsetting')}';" title="代理商提现设置">代理商提现设置</li>
                <li class="selected" onclick="location.href='{:url('admin/notifyindex')}';" title="通知设置">通知设置</li>
                <li onclick="location.href='{:url('admin/customservice')}';" title="客服设置">客服设置</li>
                <li onclick="location.href='{:url('admin/paylist')}';" title="支付设置">支付设置</li>
                <li onclick="location.href='{:url('admin/originalroadrefundsetting')}';" title="原路退回配置">原路退回配置</li>

            </ul>
        </nav>
        <div style="height:50px;"></div>
        <div id="bottom_copyright">
            <footer>
                <img src="" id="copyright_logo"/>
                <p>
                    <span id="copyright_meta"></span>
                    <br/>
                    <span id="copyright_companyname"></span>
                    <br/>
                    <span id="copyright_desc"></span>
                </p>
            </footer>
        </div>
    </aside>
    <section class="ns-base-section">
        <!-- 操作提示 -->
        <div class="ns-warm-prompt">
            <div class="alert alert-info">
                <button type="button" class="close" onclick="$('.ns-warm-prompt').hide();">&times;</button>
                <h4>
                    <i class="fa fa-bell"></i>
                    <span>操作提示</span>
                </h4>
                <div style="font-size:12px;text-indent:18px;">
                    通知系统
                </div>
            </div>
        </div>

        <div style="position:relative;margin:10px 0;">
            <!-- 三级导航菜单 -->
            <nav class="ns-third-menu">
                <ul>
                    <li class="selected">模板管理</li>
                </ul>
            </nav>
        </div>
        <div class="ns-main">
            <div class="set-style">
                <div class="template-message"><h1></h1>
                    <p style="width:90%;margin-left: 7px;">短信通知模板</p></div>
                <div class="tab-pane active">
                    <div class="left_main">
                        <ul>
                            <a v-for="(item,index) in notifyInfo" href="javascript:void(0);"
                               :class="{active:index==selectIndex}" @click="item_select(index)" id="after_register">
                                <li class="niu-li">
                                    <span class="niu-title">{{item.template_name}}</span>
                                    <span class="leftcheckbox">
									<span class="is_btn is_btn_yes" :class="{active:item.is_enable==1}"
                                          @click="checkUse(item)">是</span><span class="is_btn is_btn_no"
                                                                                :class="{active:item.is_enable==0}"
                                                                                @click="checkUse(item)">否</span>
														</span>
                                </li>
                            </a>
                        </ul>
                    </div>
                    <div class="right_main">
                        <div class="main-top">您正在编辑&nbsp;<a href="javascript:;" id="update_nameid">{{selectItem.template_name}}</a></div>
                        <div class="qianming">
                            <div style="width:75px;float:left;">模板ID：</div>
                            <input type="text" id="template_titleid" v-model="selectItem.template_title"
                                   style="margin-right: 15px !important;"
                                   class="input-common"/><span style="font-size:13px;">必须与阿里大鱼的模板ID一致，否则无效!</span></div>
                        <div class="qianming">
                            <div style="width:75px;float:left;">短信签名：</div>
                            <input type="text" id="signNameid" style="margin-right: 15px !important;"
                                   v-model="selectItem.sign_name"
                                   class="input-common"/><span style="font-size:13px;">与阿里大鱼内短信签名保持一致!</span></div>
                        {if condition="$type eq 1"}
                        <div class="qianming">
                            <div style="width:75px;float:left;">通知人手机号：</div>
                            <input type="text" style="margin-right: 15px !important;"
                                   v-model="selectItem.notification_mode"
                                   class="input-common"/><span style="font-size:13px;">请输入通知人手机号，多个手机之间用英文逗号“,”隔开</span></div>
                        {/if}
                        <div class="bl">
                            <div style="width:75px;float:left;">可用变量：</div>
                            <div style="width:88%;float: left;font-size:13px;" id="user_variable">
                                {{variableStr}}
                            </div>
                        </div>

                    </div>
                </div>
                <div class="save">
                    <input type="submit" value="保存" class="btn-common" style="margin-right: 20px;"
                           @click="ajaxSubmit();"/>
                    <a href="{:url('notifyindex')}">
                        <input type="button" value="返回" style="margin: 12px 0 0 10px!important;" class="btn-common-cancle"/>
                    </a>
                </div>
            </div>
        </div>
    </section>
</article>

<link rel="stylesheet" type="text/css" href="__STATIC__/admin/css/jquery-ui-private.css">
<script>
    var platform_shopname = '{$platformInfo.platform_site_name}';
</script>
<script type="text/javascript" src="__STATIC__/admin/js/jquery-ui-private.js" charset="utf-8"></script>
<script type="text/javascript" src="__STATIC__/admin/js/jquery.timers.js"></script>
<script type="text/javascript" src="__STATIC__/vue/vue.js"></script>
<script type="text/javascript" src="__STATIC__/vue/vue-resource.js"></script>
<script type="text/javascript" src="__STATIC__/layer/layer.js"></script>
<script type="text/javascript" src="__STATIC__/layui/layui.js"></script>
<script>
    var vueMain;
    $(function () {
        vueMain = new Vue({
            el: "#vue-main",
            data: {
                notifyInfo: {},
                selectIndex: 0,
                variableStr: '',
                selectItem: {}
            },
            mounted: function () {
                if("{$type}"==''){
                    this.$http.post("{:url('platform/Config/notifyTemplate')}", {type: 'sms'},
                        {emulateJSON: true}).then(function (res) {
                        if (res.data.code == 0) {
                            this.notifyInfo = res.data.data.template_type_list;
                            this.item_select(0);
                        }
                    });
                }else{
                    this.$http.post("{:url('platform/Config/businessNotifyTemplate')}", {type: 'sms'},
                        {emulateJSON: true}).then(function (res) {
                        if (res.data.code == 0) {
                            this.notifyInfo = res.data.data.template_type_list;
                            this.item_select(0);
                        }
                    });
                }
            },
            methods: {
                ajaxSubmit: function () {
                    var template_array = [];
                    for (i = 0; i < this.notifyInfo.length; i++) {
                        template_array.push({
                            "type_id": this.notifyInfo[i].id,
                            "template_name": this.notifyInfo[i].template_name,
                            "template_code": this.notifyInfo[i].template_code,
                            "template_type": this.notifyInfo[i].template_type,
                            "notify_type": this.notifyInfo[i].notify_type,
                            "is_enable": this.notifyInfo[i].is_enable,
                            "template_title": this.notifyInfo[i].template_title,
                            "template_content": this.notifyInfo[i].template_content,
                            "sign_name": this.notifyInfo[i].sign_name,
                            'notification_mode':"{$type}"==1?this.notifyInfo[i].notification_mode:''
                        });
                    }
                    if("{$type}"==''){
                        this.$http.post("{:url('platform/Config/updateNotifyTemplate')}", {
                                type: 'sms',
                                template_data: JSON.stringify(template_array),
                                notify_type: 'user'
                            },
                            {emulateJSON: true}).then(function (res) {
                            if (res.data.code == 0) {
                                layer.alert(res.data.msg, {icon: 6}, function () {
                                    location.reload();
                                });
                            } else {
                                layer.alert(res.data.msg, {icon: 5});
                            }
                        });
                    }else{
                        this.$http.post("{:url('platform/Config/updateNotifyTemplate')}", {
                                type: 'sms',
                                template_data: JSON.stringify(template_array),
                                notify_type: 'business'
                            },
                            {emulateJSON: true}).then(function (res) {
                            if (res.data.code == 0) {
                                layer.alert(res.data.msg, {icon: 6}, function () {
                                    location.reload();
                                });
                            } else {
                                layer.alert(res.data.msg, {icon: 5});
                            }
                        });
                    }


                },
                checkUse: function (item) {
                    item.is_enable = item.is_enable == 1 ? 0 : 1;
                },
                item_select: function (index) {
                    $(".right_main").hide();
                    this.$http.post("{:url('platform/Config/getTemplateItem')}", {template_code: this.notifyInfo[index].template_code},
                        {emulateJSON: true}).then(function (res) {
                        if (res.data.code == 0) {
                            this.selectItem = this.notifyInfo[index];
                            this.variableStr = '';
                            for (i = 0; i < res.data.data.length; i++) {
                                if (this.variableStr == '') {
                                    this.variableStr = res.data.data[i].replace_name + "（" + res.data.data[i].item_name + "）";
                                } else {
                                    this.variableStr += "，" + res.data.data[i].replace_name + "（" + res.data.data[i].item_name + "）";
                                }
                            }
                            // this.templateItem = res.data.data;
                            this.selectIndex = index;
                            $(".right_main").show();

                        }
                    });

                }

            }
        });
    });
</script>

</body>
</html>