<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>{$siteInfo.wap_shop_title}{$seoInfo.seo_title}</title>
    <meta name="keywords" content="{$seoInfo.seo_meta}">
    <meta name="description" content="{$seoInfo.seo_desc}">
    <link rel="stylesheet" type="text/css" href="__STATIC__/blue/bootstrap/css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="__STATIC__/wap/css/loaders.min.css">
    <link rel="stylesheet" type="text/css" href="__STATIC__/wap/css/loading.css">
    <link rel="stylesheet" type="text/css" href="__STATIC__/wap/css/base.css">
    <link rel="stylesheet" type="text/css" href="__STATIC__/wap/css/style.css">
    <link rel="stylesheet" type="text/css" href="__STATIC__/layui/css/layui.css"/>
    <script src="__STATIC__/web/js/jquery-1.10.2.min.js"></script>
    <script src="__STATIC__/web/js/jquery.cookie.js"></script>
    <script src="__STATIC__/blue/bootstrap/js/bootstrap.js"></script>
    <script type="text/javascript">
        var nexturl = "self";
    </script>
    <style>
        #my-pay-list dd {
            border-bottom: none;
            padding: 0.4em 5%;
            font-size: 0.9em;
            float: left;
        }

        #pay {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1666;
            background-color: #fff;
        }

        .pay-content {
            font-size: 14px;
            background-color: #fafafa;
        }

        .div-pay {
            height: 60px;
            padding-left: 80px;
            background-repeat: no-repeat;
            background-size: 40px 40px;
            background-position: 20px 50%;
            vertical-align: middle;
            line-height: 60px;
            font-size: 16px;
            background-color: #fff;
            margin-bottom: 10px;
            position: relative;
        }

        .alipay {
            background-image: url("__STATIC__/wap/images/alipay.png");
        }

        .weixinpay {
            background-image: url("__STATIC__/wap/images/weixinpay.png");
        }

        .select {
            width: 30px;
            height: 30px;
            background-image: url("__STATIC__/wap/images/select.png");
            background-size: 100%;
            position: absolute;
            top: 15px;
            right: 20px;
        }

        .selected {
            background-image: url("__STATIC__/wap/images/selected.png");
        }

        .niu-info {
            background-color: #fff;
            color: #666;
            padding-top: 10px !important;
            padding-bottom: 10px !important;
            border-bottom: 1px solid #ddd !important;
            background-image: url("__STATIC__/images/nav-left.png");
            background-repeat: no-repeat;
            background-position: 98% 50%;
            background-size: auto 60%;
            position: relative;
            z-index: 99;
            overflow: visible !important;
        }

        .important {
            color: red!important;
        }

        .niu-info select {
            font-size: 1.2em;
        }

        .niu-info select option {
            background-color: #fff;
        }

        .niu-address {
            font-size: 12px !important;
            color: #666;
            background-image: url('__STATIC__/wap/images/address.png');
            background-repeat: no-repeat;
            background-size: 2.5em 2.5em;
            background-position: 1em 50%;
            padding-left: 4em !important;
            border-bottom: 1px solid #ccc !important;
        }

        .niu-message {
            background-image: url('__STATIC__/wap/images/message.png');
        }

        .niu-div-1 {
            width: 33.33%;
            float: left;
            color: #999;
            padding: 15px 0;
        }

        .niu-div-1 .niu-p-1 {
            text-align: center;
        }

        .niu-div-1 .niu-p-2 {
            position: relative;
            text-align: center;
        }

        .niu-div-1 .niu-p-2 .niu-span-1 {
            display: inline-block;
            background-color: #999;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            vertical-align: middle;
            line-height: 20px;
            text-align: center;
            color: #fff;
            font-size: 14px;
            font-weight: bold;
            position: relative;
            z-index: 1;
            float: none;
            margin-left: 0;
        }

        .niu-div-1 .niu-p-2 .niu-span-2 {
            display: inline-block;
            width: 50%;
            height: 2px;
            background-color: #999;
            position: absolute;
            right: 0;
            top: 9px;
            z-index: 0;
        }

        .niu-div-1.active span {
            background-color: #f37872 !important;
        }

        .niu-div-1.active .niu-p-1 {
            color: #f37872;
        }

        .niu-div-1 .niu-p-2 .niu-span-3 {
            right: 50%;
        }

        .niu-dd-1 {
            /*display: block;*/
            background-image: url("__STATIC__/images/niu-info.png");
            background-size: 40px auto;
            background-repeat: no-repeat;
            background-position: 5px 50%;
            padding-left: 50px !important;
        }
        .no-img{
            background-image: none!important;
            padding-left: 5% !important;

            padding-right: 5% !important;

        }
        [v-cloak]{
            display: none;
        }
        #main{
            display: none;
        }
    </style>
    {include file="index/auto_login"/}
    <!--</script>-->
</head>
<!--loading页开始-->
<body style="background-color: #fff;">
<div style="height:44px;background-color:#000;position: fixed;top:0;left: 0;width:100%;z-index:1555">
    <div style="width:100%;height: 100%;line-height: 100%;text-align: center;position: absolute;font-size:22px;color:#fff;padding-top: 10px;">
        申请退款
    </div>
    <div style="width:24px;height:24px;float: left;margin-top: 10px;margin-left: 10px;position:relative;z-index:5555;">
        <a href="javascript:window.history.back();">
            <img src="__STATIC__/wap/images/back-5.png" style="width:100%;"/></a>
    </div>
    <div style="width:24px;height:24px;float: right;margin-top: 10px;margin-right: 10px;position:relative;z-index:5555;">
        <a href="{:url('index')}">
            <img src="__STATIC__/wap/images/home-5.png" style="width:100%;"/></a>
    </div>
</div>
<div id="main" v-cloak class="contaniner fixed-conta" style="margin-top: 30px;">
    <section class="order" style="margin-bottom: 65px;">
        <dl id="my-pay-list">
            <dd>
                <div class="niu-div-1 active">
                    <p class="niu-p-1">买家申请退款</p>
                    <p class="niu-p-2">
                        <span class="niu-span-1">1</span>
                        <span class="niu-span-2"></span>
                    </p>
                </div>
                <div class="niu-div-1" :class="{active:refundInfo.order_refund.refund_status!=0}">
                    <p class="niu-p-1">商家处理退款申请</p>
                    <p class="niu-p-2">
                        <span class="niu-span-1">2</span>
                        <span class="niu-span-2"></span>
                        <span class="niu-span-2 niu-span-3"></span>
                    </p>
                </div>
                <div class="niu-div-1" :class="{active:refundInfo.order_refund.refund_status==5}">
                    <p class="niu-p-1">退款完成</p>
                    <p class="niu-p-2">
                        <span class="niu-span-1">3</span>
                        <span class="niu-span-2 niu-span-3"></span>
                    </p>
                </div>
                <div style="clear: both"></div>
            </dd>
            <template v-if="refundInfo.order_refund.refund_status==0||refundInfo.order_refund.refund_status==-3">
                <dd class="niu-info">
                    <form class="form-inline">
                        <div class="form-group">
                            <label><span class="important">*</span>退款方式:</label>
                            <select class="form-control" style="background-color: #fff;border: none;"
                                    v-model="ajaxInfo.refund_type">
                                <option v-for="(item,index) in refund_type" :value="item.val">{{item.name}}</option>
                            </select>
                        </div>
                    </form>
                </dd>
                <dd class="niu-info">
                    <form class="form-inline">
                        <div class="form-group">
                            <label><span class="important">*</span>处理方式:</label>
                            <select class="form-control" style="background-color: #fff;border: none;"
                                    v-model="ajaxInfo.refund_reason">
                                <option v-for="(item,index) in refund_reason" :value="item.name">{{item.name}}</option>
                            </select>
                        </div>
                    </form>
                </dd>
                <!--<dd class="niu-info" style="background-image: none;">-->
                    <!--<form class="form-inline">-->
                        <!--<div class="form-group">-->
                            <!--<label><span class="important">*</span>退款金额:</label>-->
                            <!--<input style="float: none;margin: 0;" v-model="ajaxInfo.refund_require_money" type="text"-->
                                   <!--class="form-control" :placeholder="'最多可退款'+refundInfo.refund_money+'元'">-->
                        <!--</div>-->
                    <!--</form>-->
                <!--</dd>-->
                <dd class="niu-info" style="background-image: none;" v-if="ajaxInfo.refund_reason=='其他'">
                    <form class="form-inline">
                        <div class="form-group">
                            <label style="width:100%;text-align: center;">退款原因填写</label>
                            <textarea id="reason" class="form-control" rows="4" style="width: 100%;"></textarea>
                        </div>
                    </form>
                </dd>
                <dd style="text-align: center;">
                    <button type="button" class="btn btn-primary" @click="ajaxSubmit()"
                            style="width:60%;padding: 10px;font-size:1.2em;letter-spacing: 3px;margin-top: 10px;">提交退款申请
                    </button>
                </dd>
            </template>
            <template v-if="refundInfo.order_refund.refund_status!=0&&refundInfo.order_refund.refund_status!=-3">
                <dd class="niu-dd-1" :class="{'no-img':refundInfo.order_refund.refund_status==2&&refundInfo.order_refund.refund_type!=1}">
                    <template v-if="refundInfo.order_refund.refund_status==-1">
                        <h1 style="font-weight: bold;">卖家拒绝你的退款申请</h1>
                        <p></p>
                    </template>
                    <template v-if="refundInfo.order_refund.refund_status==1">
                        <h1 style="font-weight: bold;">等待商家处理退款申请</h1>
                        <p>如果商家同意，退款申请将达成并退款至您的账号中。</p>
                    </template>
                    <template v-if="refundInfo.order_refund.refund_status==2">
                    <template v-if="refundInfo.order_refund.refund_type==1">
                        <h1 style="font-weight: bold;">你已成功申请退款</h1>
                        <p>等待卖家处理退款申请。</p>
                    </template>
                        <template v-else>
                            <h2 style="font-weight: bold;">请退款并填写退款信息</h2>
                            <h1 style="font-weight: bold;">1、请退款</h1>
                            <p>未经卖家同意，请不要使用平邮或到付</p>
                            <p>退款地址:{{refundInfo.shop_info.shop_address}}&nbsp;&nbsp;{{refundInfo.shop_info.seller_name}}&nbsp;&nbsp;{{refundInfo.shop_info.seller_mobile}}&nbsp;&nbsp;{{refundInfo.shop_info.seller_zipcode}}</p>
                            <h1 style="font-weight: bold;">2、请填写物流信息</h1>
                            <h1 style="font-weight: bold;padding-left: 1em;line-height: 25px;"><small style="font-size:0.9em;">(逾期未填，默认不通过)</small></h1>
                            <br/>
                            <form class="form-inline">
                                <div class="form-group">
                                    <label><span class="important">*</span>物流公司:</label>
                                    <input style="float: none;margin: 0;" v-model="refund_company" type="text"
                                           class="form-control">
                                </div>
                                <br/>
                                <div class="form-group">
                                    <label><span class="important">*</span>运单编号:</label>
                                    <input style="float: none;margin: 0;" v-model="refund_no" type="text"
                                           class="form-control">
                                </div>
                            </form>
                            <p style="margin-top: 10px;text-align: center;"><button type="button" class="btn btn-info" style="width:60%;padding: 8px;font-size:1.2em;letter-spacing: 0.5em;" @click="expressSave()">提交</button></p>
                        </template>
                    </template>
                    <template v-if="refundInfo.order_refund.refund_status==3">
                        <h1 style="font-weight: bold;">等待商家收货</h1>
                        <p>如果商家同意，退款申请将达成并退款至您的账号中。</p>
                    </template>
                    <template v-if="refundInfo.order_refund.refund_status==4">
                        <h1 style="font-weight: bold;">你已申请退款成功</h1>
                        <p>等待卖家处理退款申请!</p>
                    </template>

                    <template v-if="refundInfo.order_refund.refund_status==5">
                        <h1 style="font-weight: bold;">退款成功</h1>
                        <p>{{refundInfo.order_refund.refund_real_money}}元&nbsp;&nbsp;&nbsp;&nbsp;退款时间：{{refundInfo.order_refund.refund_time}}</p>
                    </template>
                </dd>
            </template>
        </dl>
    </section>
</div>
<script type="text/javascript" src="__STATIC__/vue/vue.js"></script>
<script type="text/javascript" src="__STATIC__/vue/vue-resource.js"></script>
<script type="text/javascript" src="__STATIC__/layer/layer.js"></script>
<script>
    var mainVue;
    $(function () {
        mainVue = new Vue({
            el: "#main",
            data: {
                refund_type: [
                    {name: "我要退款，但不退货", val: 1},
                    {name: "我要退款，并且退货", val: 2},
                ],
                refund_type_index: 0,
                refun_type_show: false,
                refund_reason: [
                    {name: "买/卖双方协商一致"},
                    {name: "买错/多买/不想要"},
                    {name: "商品质量问题"},
                    {name: "未收到货品"},
                    {name: "其他"},
                ],
                refund_reason_index: 0,
                refun_reason_show: false,
                refundInfo: {
                    order_refund:{refund_status:''}
                },
                ajaxInfo: {
                    refund_type: 1,
                    refund_require_money: 0,
                    refund_reason: '买/卖双方协商一致'
                },
                refund_company:'',
                refund_no:''
            },
            mounted: function () {
                this.$http.post("{:url('shop/Order/refundDetail')}", {order_goods_id: "{$order_goods_id}"}, {
                        headers: {
                            authKey: $.cookie('authKey'),
                            sessionId: $.cookie('sessionId')
                        }
                    },
                    {emulateJSON: true}).then(function (res) {
                    if (res.data.code == 0) {
                        this.refundInfo = res.data.data;
                        $("#main").show();
//                        this.orderInfo = res.data.data.order_details;
                    }
                });
            },
            methods: {
                ajaxSubmit: function () {
                    var reason;
                    if (this.ajaxInfo.refund_reason == "其他") {
                        reason = $("#reason").val();
                        if (reason == '') {
                            layer.msg("请填写退款原因...", {shade: [0.2, "#393D49"]});
                            return;
                        }
                    } else {
                        reason = this.ajaxInfo.refund_reason;
                    }
                    // if (!(this.ajaxInfo.refund_require_money > 0 && this.ajaxInfo.refund_require_money <= this.refundInfo.refund_money)) {
                    //     layer.msg("请输入正确的退款金额...", {shade: [0.2, "#393D49"]});
                    //     return;
                    // }

                    this.$http.post("{:url('shop/Order/orderGoodsRefundAskfor')}", {
                            order_id: this.refundInfo.order_refund.order_id,
                            order_goods_id: "{$order_goods_id}",
                            refund_type: this.ajaxInfo.refund_type,
                            refund_require_money: this.ajaxInfo.refund_require_money,
                            refund_reason: reason
                        }, {
                            headers: {
                                authKey: $.cookie('authKey'),
                                sessionId: $.cookie('sessionId')
                            }
                        },
                        {emulateJSON: true}).then(function (res) {
                        if (res.data.code == 0) {
                            layer.msg(res.data.msg, {shade: [0.2, "#393D49"], icon: 6});
                            setTimeout(function () {
                                location.reload();
                            },2000);

                        } else {
                            layer.msg(res.data.msg, {shade: [0.2, "#393D49"], icon: 5});

                        }

                    });

                },
                expressSave:function () {
                    this.$http.post("{:url('shop/Order/orderGoodsRefundExpress')}", {
                        order_id: this.refundInfo.order_refund.order_id,
                        order_goods_id: "{$order_goods_id}",
                        refund_express_company:this.refund_company,
                        refund_shipping_no:this.refund_no,
                        refund_reason:''
                        }, {
                            headers: {
                                authKey: $.cookie('authKey'),
                                sessionId: $.cookie('sessionId')
                            }
                        },
                        {emulateJSON: true}).then(function (res) {
                        if (res.data.code == 0) {
                            layer.msg(res.data.msg,{shade: [0.2, "#393D49"]});
                            setTimeout(function () {
                                location.reload();
                            },2000);
                        }else{
                            layer.msg(res.data.msg,{shade: [0.2, "#393D49"]});
                        }
                    });
                }
            },

        });
    });
</script>

</body>
</html>