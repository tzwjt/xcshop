<!DOCTYPE html>
<!-- saved from url=(0048)https://m.vip.com/product-1560557-270829018.html -->
<html style="font-size: 40px;">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <meta content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width" name="viewport">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <title>{$siteInfo.wap_shop_title}{$seoInfo.seo_title}</title>
    <meta name="keywords" content="{$seoInfo.seo_meta}">
    <meta name="description" content="{$seoInfo.seo_desc}">
    <meta name="baidu-site-verification" content="qYMZZ5kMNb">
    <meta name="sogou_site_verification" content="G7nmLR75yc">
    <meta name="baidu-tc-cerfication" content="0a8c6d28b570b218f78510c29be4529b">
    <meta name="360-site-verification" content="8b6121969d78afda8caeb69053fa29d9">

    <script type="text/javascript">
        /*响应式布局 start*/
        function _set_font_size_750() {
            //先留着这个方法，不要删，要给专题调用
        }

        function setRootFontSize() {
            var width = document.documentElement.clientWidth, fontSize;
            if (width > 540) {
                width = 540;
            }
            fontSize = (width / 10);
            document.getElementsByTagName('html')[0].style['font-size'] = fontSize + 'px';
            window.wapParams = {
                rootFontSize: fontSize,
                clientWidth: width
            };
        }

        setRootFontSize();
        window.addEventListener('resize', function () {
            setRootFontSize();
        }, false);
        /*响应式布局 end*/
    </script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="__STATIC__/web/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="__STATIC__/wap/js/detail.js"></script>
    <link rel="stylesheet" href="__STATIC__/wap/css/vendors.6cc56fe8.css">
    <link rel="stylesheet" href="__STATIC__/wap/css/product-detail.dbb32e4b.css">
    <script async="" src="__STATIC__/wap/js/vtm_m.js"></script>
    <script type="text/javascript" async=""
            src="__STATIC__/wap/js/login-deal.min.js"></script>
    <link rel="stylesheet" href="__STATIC__/wap/css/login.css">
    <link rel="stylesheet" href="__STATIC__/css/pro-detail.css">
    <script src="__STATIC__/web/js/jquery-1.10.2.min.js"></script>
    <script src="__STATIC__/web/js/jquery.cookie.js" type="text/javascript"></script>
    <style>
        .main-content {
            padding-left: 5%;
            padding-right: 5%;
        }

        .main-content img {
            max-width: 100% !important;
        }

        .promotion {
            display: inline-block;
            padding: 0.2em 0.5em;
            border: 1px solid #00abe3;
            color: #00abe3;
            margin: 0.3em 1em;
        }

        .product-meta {
            margin-bottom: 0.2em;
        }

        .product-title p {
            margin: 8px 0;
        }

        .type_name span {
            display: inline-block;
            padding: 0.5em;
            border: 1px solid #000;
            min-width: 60px;
        }

        .num-style {
            width: 32px;
            height: 32px;
            text-align: center;
            font-size: 25px;
            font-weight: bolder;
            line-height: 30px;
            vertical-align: middle;
            display: inline-block;
            border: 1px solid #c0bfc5;
        }

        span.show-title {
            display: inline-block;
            width: 33.33%;
            height: 100%;
            text-align: center;

        }

        span.select {
            color: #e92076;
        }

        .param-list {
            font-size: 1.3em;
            margin: 0.5em 0;
        }

        [v-cloak] {
            display: none;
        }

        .table-bordered > tbody > tr > td, .table-bordered > tbody > tr > th, .table-bordered > tfoot > tr > td, .table-bordered > tfoot > tr > th, .table-bordered > thead > tr > td, .table-bordered > thead > tr > th {
            border: none;
        }

        .niu-border-bottom {
            border-bottom: 1px dotted #cfcfcf !important;
        }

        .niu-div-1 {
            margin: 0 1em;
            padding: 10px 0;
            font-size: 1.2em;
            border-bottom: 1px solid #ccc;
        }

        .niu-div-1 span {
            font-size: 0.8em;
            display: inline-block;
            padding: 5px;
            background-color: red;
            color: #fff;
            border-radius: 0.5em;
            margin-right: 0.5em;
        }

        .coupon-div {
            display: none;
        }

        /*.niu-coupon{*/
        /*padding:0.5em 0 0.5em 82px;border-bottom: 1px dotted #999;font-size:0.9em;*/
        /*background-image: url("__STATIC__/images/receive-coupon.png");*/
        /*background-repeat: no-repeat;*/
        /*background-size: 80px 16px;*/
        /*background-position: 0 50%;*/
        /*!*receive-coupon*!*/
        /*}*/
    </style>
</head>
<body>
{include file="index/nav_bar"/}
<div id="main" v-cloak>
    <div id="J-detail-p-relative" class="p-relative">
        <div id="myCarousel" class="carousel slide">
            <!-- 轮播（Carousel）指标 -->
            <ol class="carousel-indicators">
                <li data-target="#myCarousel" v-for="(item,index) in imgUrl" :data-slide-to="index"
                    :class="{'active':index==0}"></li>
            </ol>
            <!-- 轮播（Carousel）项目 -->
            <div class="carousel-inner">
                <div v-for="(item,index) in imgUrl" :class="{'item':true,'active':index==0}"
                     style="text-align: center;">
                    <img :src="item.bigImg" style="width:100%;">
                </div>
            </div>
        </div>
    </div>
    <div style="width:100%;background-color: red;color:#fefefe;position: relative;" v-if="goodInfo.promotion_info!=''">
        <div style="display: inline-block;position: absolute;bottom:100%;left:0;z-index:1055;background-color: red;font-size: 1.2em;padding: 8px;">
            {{this.goodInfo.promotion_detail.discount_name}}
        </div>
        <div style="float: left;font-size:2.2em;padding: 12px;">¥{{this.goodInfo.promotion_price}}</div>
        <div style="float: right;font-size:1.2em;">
            <p style="margin: 6px 0;">距结束仅剩</p>
            <p class="niu-p-1">
                <span>{{promotion_remaining_time.days}}</span>天<span>{{promotion_remaining_time.hours}}</span>时<span>{{promotion_remaining_time.minutes}}</span>分<span>{{promotion_remaining_time.seconds}}</span>秒
            </p>
        </div>
        <div style="clear: both;"></div>
    </div>
    <div id="J-product-meta">
        <div class="product-meta">
            <div class="price-box">
                <div class="price-info-list clearfix">
                    <p class="J-sale-price sale-price f-left" style="color: red;"><i class="f-left">¥</i><span>{{goodPrice}}</span>
                    </p>
                    <span style="color:red;font-weight: bold;" v-if="goodInfo.status!=1">非卖品</span>
                    </p>
                </div>
            </div>
            <h1 class="product-name " data-classify="">
                {{goodInfo.title}}
            </h1>
            <h2 style="color:#9c9c9c;padding:0.5em 1em;">{{goodInfo.sub_title}}</h2>
            <div>
                <span class="promotion" v-if="goodInfo.point_exchange_type==0">不支持积分支付</span>
                <span class="promotion" v-if="goodInfo.point_exchange_type==1">支持积分兑换</span>
                <span class="promotion" v-if="goodInfo.point_exchange_type==2">支付积分支付</span>
                <span class="promotion" v-if="goodInfo.point_exchange_type==0">支付优惠券</span>
                <span class="promotion" v-if="goodInfo.give_point!=0">赠送{{goodInfo.give_point}}积分</span>
            </div>
        </div>
    </div>
    <!--原料-->
    <div class="stock" v-if="goodInfo.type==4" style="border-top: 1px solid rgb(204, 204, 204)">
        <table class="table table-bordered niu-table" style="border: none;margin-bottom: 0;">
            <tbody>
            <template v-for="(item,index) in goodInfo.comb_goods_list">
                <tr style="height:30px;">
                    <td rowspan="2" style="width:55px;height:55px;" @click="gotoStock(item.comb_goods_id)"><img
                            :src="item.thumb.pic_cover_micro" style="width:55px;height: 55px;"></td>
                    <td @click="gotoStock(item.comb_goods_id)"
                        style="font-size:1.2em;padding: 0px;vertical-align: bottom;">{{item.title}}
                    </td>
                </tr>
                <tr style="height:30px;">
                    <td style="padding: 4px;color:rgb(156, 156, 156);"
                        :class="{'niu-border-bottom':index!=goodInfo.comb_goods_list.length-1}">
                        {{item.num}}{{item.unit}}&nbsp;&nbsp;&nbsp;&nbsp;¥{{item.num*item.price}}
                    </td>
                </tr>
            </template>
            </tbody>
        </table>
    </div>
    <!--<div v-if="couponInfo.length!=0" class="niu-div-1" style="padding-top: 0;padding-bottom: 0;border-bottom: none;">-->
    <!--<ul>-->
    <!--<li class="niu-coupon">领取优惠券</li>-->
    <!--</ul>-->

    <!--&lt;!&ndash;<span>优惠券</span>&ndash;&gt;-->
    <!--&lt;!&ndash;<ul>&ndash;&gt;-->
    <!--&lt;!&ndash;<li class="niu-coupon" v-for="(item,index) in couponInfo" v-if="couponIndex!=1||index==0">{{item.money}}元优惠券，满{{item.at_least}}元可用<a style="color:#00abe3;margin-left: 1em;" @click="getCoupon(index)">领取</a><a v-if="index==0&&couponInfo.length>1" style="color:#00abe3;margin-left: 1em;" @click="couponIndex=couponIndex==1?0:1;">{{couponIndex==1?"展开":"收起"}}</a></li>&ndash;&gt;-->
    <!--&lt;!&ndash;</ul>&ndash;&gt;-->
    <!--</div>-->
    <div class="address"
         style="font-size:14px;padding: 0.5em 0;margin:0 1em;border-bottom: 1px solid #ccc;"
         v-if="goodInfo.status==1">
        配送至：{{addressInfo.province+","+addressInfo.city+","+addressInfo.district}}(<span
            v-if="goodInfo.is_send_free==1">包邮</span><span v-if="goodInfo.is_send_free!=1">运费:{{sendPrice}}</span>)&nbsp;&nbsp;&nbsp;&nbsp;
        <a style="color:#00abe3" onclick="showAddress()">更改</a>
    </div>
    <div v-if="couponInfo.length!=0" class="niu-div-1" @click="showCoupon()">
        <img src="__STATIC__/images/receive-coupon.png" style="margin-right:8px;padding-top: 5px;"/>领取优惠券
    </div>
    <div v-if="goodInfo.mansong_name!=''" class="niu-div-1">
        <span>满送</span>{{goodInfo.mansong_name}}
    </div>
    <div v-if="goodInfo.baoyou_name!=''" class="niu-div-1">
        <span>包邮</span>{{goodInfo.baoyou_name}}
    </div>
    <div id="J-product-service-text">
        <div class="product-service-text border-b">
            <div class="service-list" id="J-service-more">
                <ul>
                    <li v-if="goodInfo.quality==1">
                        <i class="icon-circle-check"></i>
                        100%正品保证
                    </li>
                    <li v-if="goodInfo.seven==1">
                        <i class="icon-circle-check"></i>
                        7天无理由退换
                    </li>
                    <li v-if="goodInfo.repair==1">
                        <i class="icon-circle-check"></i>
                        终身包修
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <!--<div style="background-color: #eee;height:3.1em;padding: 0.5em 0;font-size:1.2em;">-->
    <!--<h3 id="J-pro-param-scroll" style="background-color: #fff;line-height:2em;"><span class="show-title"-->
    <!--:class="{'select':showContent==1}"-->
    <!--@click="showContent=1;">图文详情</span><span-->
    <!--class="show-title" :class="{'select':showContent==2}" @click="showContent=2;">产品参数</span><span-->
    <!--class="show-title" :class="{'select':showContent==3}" @click="showContent=3;">宝贝评论</span></h3>-->
    <!--</div>-->
    <div id="J-wrap-product-detail-info" style="border-top: 1px solid #ccc;">
        <div id="J-product-attr">
            <div class="product-attr">
                <div v-html="goodInfo.content" class="main-content" v-if="showContent==1"></div>
            </div>
        </div>
    </div>
    <div class="foot"
         style="position: fixed;z-index:500;width:100%;bottom: 0;left:0;background-color: #fff;padding-top: 0.5em;padding-bottom: 0.5em;"
         v-if="goodInfo.status==1">
        <div class="col-xs-2 text-center" style="height:100%;">
            <a href="{:url('shopcart')}">
                <img src="__STATIC__/wap/images/shopping_cart.png" style="width:50px">
                <span v-text="cartCount"
                      style="color:red;position: absolute;top:-0.5em;right:-0.1em;font-size:1.6em;"></span>
            </a>
        </div>
        <div class="col-xs-10">
            <button class="btn btn-lg btn-primary"
                    style="font-size:16px;width:49%;background-color: #f85;border: none;border-radius: 0;"
                    @click="showProduct(1)">加入购物车
            </button>
            <button class="btn btn-lg btn-primary"
                    style="font-size:16px;width:49%;background-color: #f44;border: none;border-radius: 0;"
                    @click="showProduct(2)">立即购买
            </button>
        </div>
    </div>

    <div class="product-info" style="position: fixed;z-index:1500;top:0;left:0;width:100%;height:100%;display: none;">
        <div style="width:100%;height:100%;background-color: #000;opacity: 0.3;"></div>
        <div class="product-main"
             style="position: absolute;width:100%;z-index:1500;bottom: 0;left: 0;background-color: #fff;opacity: 1;padding-bottom: 1em;">
            <div class="product-title"
                 style="border-bottom: 1px solid #eee;padding:10px 10px 10px 150px;position: relative;">
                <img :src="goodInfo.thumb_info.pic_cover_small"
                     style="background-color:#fff;padding:5px;width: 120px;height:120px;display:inline-block;position: absolute;top:-50px;left: 10px;">
                <p style="color:red;font-size: 1.2em;">¥{{price}}</p>
                <p style="font-size:0.8em;">库存:<span style="color:red"> {{total}}</span>件</p>
                <p style="font-size:1.5em;" v-if="goodInfo.has_option==1">请选择规格</p>
                <span style="display: block;position: absolute;top:10px;right:10px;font-size:1.5em;font-weight: bold"
                      @click="hideProduct()">X</span>
            </div>
            <div class="product-size J-product-size border-b" style="border-bottom: 1px solid #cfcfcf;"
                 v-if="goodInfo.has_option==1">
                <template v-for="(item,index) in goodInfo.spec_list">
                    <h1>
                        {{item.title}}
                    </h1>
                    <ul id="J-product-size-list" class="product-size-list clearfix ">
                        <li v-for="(item1,index1) in item.spec_item_list" :data-for-index="index+'-'+index1"
                            onclick="specIndex(this)" class="J-size-list-item size-list-item">
                            <span class="size">{{item1.title}}</span>
                        </li>
                    </ul>
                </template>
            </div>
            <div class="number" style="padding:1em;font-size:18px;">
                数量：<span class="num-style" @click="changeNum(1)">-</span><input type="number" v-model="number"
                                                                                @change="checkNum()"
                                                                                style="text-align:center;position:relative;top:1px;border-top:1px solid #c0bfc5;border-bottom:1px solid #c0bfc5;border-left:none;border-right:none;width:50px;height: 32px;"><span
                    class="num-style" @click="changeNum(2)">+</span>
            </div>
            <div class="col-xs-12">
                <button class="btn btn-default btn-lg" @click="addCart()"
                        style="background-color: #f44;width:100%;color:#fff;">确&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;定
                </button>
            </div>
        </div>
    </div>
    <!--领取优惠券-->
    <div class="coupon-div"
         style="position: fixed;width: 100%;height: 100%;background-color: #000;opacity: 0.3;top:0;left: 0;z-index: 1665;"></div>
    <div class="bottom_popup coupon-div" style="z-index:1666;">
        <div class="bottom_popup_title">
            领取优惠劵
            <img src="__STATIC__/wap/images/close-1.png" class="pull-right" @click="hideCoupon()"
                 style="width:25px;height:25px;">
        </div>
        <ul class="coupon_list">
            <li v-for="(item,index) in couponInfo" @click="getCoupon(index)">
                <div class="js-coupon" data-max-fetch="10" data-receive-quantity="0" data-coupon-id="2">
                    <img src="__STATIC__/wap/images/goods_coupon_member.png" style="width:97%;height: 90px;">
                    <div class="coupon-price" style="">￥{{item.money}}</div>
                    <div class="coupon-lose">
                        截止时间：<span>{{item.end_time}}</span>
                    </div>
                </div>
            </li>
            <!--&lt;!&ndash;<li class="niu-coupon" v-for="(item,index) in couponInfo" v-if="couponIndex!=1||index==0">{{item.money}}元优惠券，满{{item.at_least}}元可用<a style="color:#00abe3;margin-left: 1em;" @click="getCoupon(index)">领取</a><a v-if="index==0&&couponInfo.length>1" style="color:#00abe3;margin-left: 1em;" @click="couponIndex=couponIndex==1?0:1;">{{couponIndex==1?"展开":"收起"}}</a></li>&ndash;&gt;-->
        </ul>
        <div class="bottom_popup_button" id="complete" style="margin-top: 10px;" @click="hideCoupon()">
            <span>完成</span>
        </div>
    </div>
    <!--<div style="width:40px;font-size:8px;position: fixed;right: 10px;bottom: 60px;text-align: center;"-->
         <!--@click="getWxShare()">-->
        <!--<p><img src="__STATIC__/wap/images/weixin.png" style="width: 100%;text-align: center;"/></p>-->
        <!--&lt;!&ndash;<p>微信分享</p>&ndash;&gt;-->
    <!--</div>-->
</div>

<script src="__STATIC__/wap/js/address.js"></script>
<script src="__STATIC__/web/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="__STATIC__/vue/vue.js"></script>
<script type="text/javascript" src="__STATIC__/vue/vue-resource.js"></script>
<script type="text/javascript" src="__STATIC__/layer/layer.js"></script>
<script language="javascript" src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script>
    //    layer.load();
    var main;
    var mailType = 1;
    $(function () {
        main = new Vue({
            el: "#main",
            data: {
                goodInfo: {thumb_info: {pic_cover_small: ''}, status: 1, promotion_detail: {discount_name: ''}},
                goodPrice: '',//页面显示价格
                imgUrl: [],
                number: 1,
                specNum: [],
                price: '',
                total: '',
                market_price: '',
                sku_id: 0,
                cartCount: '',
                showContent: 1,
                addressInfo: {
                    province: '江苏省',
                    city: '泰州市',
                    district: '海陵区'
                },
                promotion_remaining_time: {
                    days: '',
                    hours: '',
                    minutes: '',
                    seconds: ''
                },
                couponInfo: [],
                couponIndex: 0,
                sendPrice: ''
            },
            mounted: function () {
                //获取位置信息

                if ($.cookie("province") == null || $.cookie("province") == '' || $.cookie("city") == null || $.cookie("city") == '' || $.cookie("district") == null || $.cookie("district") == '') {
                    var local = new Location();
                    var resInfo = '';
                    local.getLocation(function (res) {
                        //此处就是返回的地理位置信息
                        resInfo = res;

                        main.addressInfo.province = resInfo.province;
                        main.addressInfo.city = resInfo.city;
                        main.addressInfo.district = resInfo.district;
                        $.cookie("province", main.addressInfo.province);
                        $.cookie("city", main.addressInfo.city);
                        $.cookie("district", main.addressInfo.district);
                    })
                    // setTimeout(function () {
                    //     if (resInfo != '' && ("province" in resInfo)) {
                    //         this.addressInfo.province = resInfo.province;
                    //         this.addressInfo.city = resInfo.city;
                    //         this.addressInfo.district = resInfo.district;
                    //     }
                    //
                    //     $.cookie("province", this.addressInfo.province);
                    //     $.cookie("city", this.addressInfo.city);
                    //     $.cookie("district", this.addressInfo.district);
                    // }, 4000);
                } else {
                    this.addressInfo.province = $.cookie("province");
                    this.addressInfo.city = $.cookie("city");
                    this.addressInfo.district = $.cookie("district");
                }
                this.getCouponInfo();

                this.$http.post("{:url('shop/goods/goodsDetail',array('goods_id'=>$id))}", {}, {
                        headers: {
                            authKey: $.cookie('authKey'),
                            sessionId: $.cookie('sessionId')
                        }
                    },
                    {emulateJSON: true}).then(function (res) {
                    if (res.data.code == 0) {
                        this.goodInfo = res.data.data;
                        this.getExpress();
                        if (this.goodInfo.promotion_info != '') {
                            var interval_time = this.goodInfo.promotion_detail.end_time_stamp - this.goodInfo.promotion_detail.cur_time_stamp;
                            var interval = setInterval(function () {
                                main.promotion_remaining_time.days = parseInt(interval_time / 86400);
                                var time = interval_time - main.promotion_remaining_time.days * 86400;
                                main.promotion_remaining_time.hours = parseInt(time / 3600);
                                if (main.promotion_remaining_time.hours < 10) {
                                    main.promotion_remaining_time.hours = "0" + main.promotion_remaining_time.hours;
                                }
                                time = time - main.promotion_remaining_time.hours * 3600;
                                main.promotion_remaining_time.minutes = parseInt(time / 60);
                                if (main.promotion_remaining_time.minutes < 10) {
                                    main.promotion_remaining_time.minutes = "0" + main.promotion_remaining_time.minutes;
                                }
                                time = time - main.promotion_remaining_time.minutes * 60;
                                main.promotion_remaining_time.seconds = time;
                                if (main.promotion_remaining_time.seconds < 10) {
                                    main.promotion_remaining_time.minutes = "0" + main.promotion_remaining_time.minutes;
                                }
                                interval_time--;
                                if (interval_time < 0) {
                                    window.clearInterval(interval);
                                }
                            }, 1000);
                        }
                        if (this.goodInfo.thumb_info != "") {
                            this.imgUrl.push({
                                smallImg: this.goodInfo.thumb_info.pic_cover_small,
                                bigImg: this.goodInfo.thumb_info.pic_cover_big
                            });
                            for (i = 0; i < this.goodInfo.thumb_url_list.length; i++) {
                                if (i > 3) {
                                    break;
                                }
                                this.imgUrl.push({
                                    smallImg: this.goodInfo.thumb_url_list[i].pic_cover_small,
                                    bigImg: this.goodInfo.thumb_url_list[i].pic_cover_big
                                });
                            }
                            this.bigImg = this.imgUrl[0].bigImg;
                        }
//                        this.specNum=new Array(this.goodInfo.spec_list.length);
                        for (i = 0; i < this.goodInfo.spec_list.length; i++) {
                            this.specNum[i] = -1;
                        }
                        this.total = this.goodInfo.total;
                        this.market_price = this.goodInfo.market_price;
                        if (this.goodInfo.promotion_info == "") {
                            if (this.goodInfo.is_show_member_price == 0) {
                                this.goodPrice = this.goodInfo.promotion_price;
                                this.price = this.goodInfo.promotion_price;
                            } else {
                                var price = this.goodInfo.promotion_price > this.goodInfo.member_price ? this.goodInfo.promotion_price : this.goodInfo.member_price;
                                this.goodPrice = price;
                                this.price = price;
                            }
                        } else {
                            if (this.goodInfo.is_show_member_price == 0) {
                                this.goodPrice = this.goodInfo.promotion_price;
                                this.price = this.goodInfo.promotion_price;
                            } else {
                                var price = this.goodInfo.promotion_price > this.goodInfo.member_price ? this.goodInfo.promotion_price : this.goodInfo.member_price;
                                this.goodPrice = price;
                                this.price = price;
                            }
                        }
//                        this.price = this.goodInfo.promotion_price;

                        this.$http.post("{:url('shop/goods/getCartNum',array('goods_id'=>$id))}", {},
                            {emulateJSON: true}).then(function (res) {
                            if (res.data.code == 0) {
                                this.cartCount = res.data.data;
                            }
                        });
                    }
                });
            },
            methods: {

                getExpress: function () {
                    if (this.goodInfo.is_send_free != 1) {
                        //获取运费信息
                        this.$http.post("{:url('shop/Goods/getShippingFeeNameByLocation')}", {
                                'goods_id': "{$id}",
                                province: this.addressInfo.province,
                                city: this.addressInfo.city,
                                district: this.addressInfo.district,
                            }, {
                                headers: {
                                    authKey: $.cookie('authKey'),
                                    sessionId: $.cookie('sessionId')
                                }
                            },
                            {emulateJSON: true}).then(function (res) {
                            if (res.data.code == 0) {
                                this.sendPrice = res.data.data;
                            }
                        });
                    }
                },
                getCouponInfo: function () {
                    this.$http.post("{:url('shop/goods/goodsGoupon',array('goods_id'=>$id))}", {}, {
                            headers: {
                                authKey: $.cookie('authKey'),
                                sessionId: $.cookie('sessionId')
                            }
                        },
                        {emulateJSON: true}).then(function (res) {
                        if (res.data.code == 0) {
                            this.couponInfo = res.data.data;
                        }
                    });
                },
                getCoupon: function (index) {
                    if (this.couponInfo[index].receive_quantity >= this.couponInfo[index].max_fetch) {
                        layer.msg("该优惠券最多可领取" + this.couponInfo[index].max_fetch + "张,你已经不可以在领取了...", {shade: [0.2, "#333"]});
                        return;
                    }
                    this.$http.post("{:url('shop/member/getCoupon')}", {coupon_type_id: this.couponInfo[index].id}, {
                            headers: {
                                authKey: $.cookie('authKey'),
                                sessionId: $.cookie('sessionId')
                            }
                        },
                        {emulateJSON: true}).then(function (res) {
                        if (res.data.code == 0) {
                            layer.msg(res.data.msg, {shade: [0.2, "#333"]});
                            this.getCoupon();
//                            this.cartCount = res.data.data;
                        }
                        if (res.data.code == 1) {
                            layer.msg("你暂未登录是否去登录？", {
                                shade: [0.2, "#333"], btn: ["登录", "取消"], yes: function () {
                                    location.href = "{:url('login')}";
                                }
                            });
                        }
                        if (res.data.code > 1) {
                            layer.msg(res.data.msg, {shade: [0.2, "#333"]});
                        }
                    });
                },
                changeNum: function (type) {
                    if (type == 1) {
                        if (this.number > 1)
                            this.number--;
                    } else {
                        this.number++;
                    }
                },
                checkNum: function () {
                    var r = /^\+?[1-9][0-9]*$/;　　//正整数
                    flag = r.test(this.number);
                    if (!flag) {
                        this.number = this.goodInfo.min_buy > 0 ? this.goodInfo.min_buy : 1;
                        layer.msg("输入的数字必须为正整数", {shade: [0.2, '#393D49']});
                    } else {
                        if (this.goodInfo.max_buy > 0 && this.number > this.goodInfo.max_buy) {
                            this.number = this.goodInfo.max_buy;
                            layer.msg("最大购买量为" + this.goodInfo.max_buy, {shade: [0.2, '#393D49']});
                        }
                        if (this.goodInfo.min_buy > 0 && this.number < this.goodInfo.min_buy) {
                            this.number = this.goodInfo.min_buy;
                            layer.msg("最小购买量为" + this.goodInfo.min_buy, {shade: [0.2, '#393D49']});
                        }
                    }
                },
                getInfo: function () {
                    var str = '';
                    for (i = 0; i < this.goodInfo.spec_list.length; i++) {
                        if (this.specNum[i] == -1) {
                            return;
                        }
                        if (i == this.goodInfo.spec_list.length - 1) {
                            str += this.goodInfo.spec_list[i].spec_item_list[this.specNum[i]].id;
                        } else {
                            str += this.goodInfo.spec_list[i].spec_item_list[this.specNum[i]].id + "_";
                        }
                    }
                    for (i = 0; i < this.goodInfo.sku_list.length; i++) {
                        if (this.goodInfo.sku_list[i].specs == str) {
                            if (this.goodInfo.is_show_member_price == 0) {
                                this.price = this.goodInfo.sku_list[i].promotion_price;
                            } else {
                                this.price = this.goodInfo.sku_list[i].promotion_price > this.goodInfo.sku_list[i].member_price ? this.goodInfo.sku_list[i].promotion_price : this.goodInfo.sku_list[i].member_price;
                            }
//                            this.price = this.goodInfo.sku_list[i].promotion_price;
                            this.total = this.goodInfo.sku_list[i].stock;
//                            this.market_price = this.goodInfo.sku_list[i].market_price;
                            this.sku_id = this.goodInfo.sku_list[i].id;
                            break;
                        }
                    }
                },
                showProduct: function (type) {
                    mailType = type;
                    $(".product-info").show("slow");
                },
                hideProduct: function () {
                    $(".product-info").hide("slow");
                },
                addCart: function () {
                    if (this.goodInfo.has_option == 1 && this.sku_id == 0) {
                        layer.msg("请先选择商品规格", {shade: [0.2, '#393D49']});
                        return;
                    }
                    if (this.total == 0) {
                        layer.msg("该商品库存为0，无法购买...", {shade: [0.2, '#393D49']});
                        return;
                    }
                    var data = {
                        goods_id: "{$id}",
                        sku_id: this.sku_id,
                        price: this.price,
                        num: this.number
                    };
                    if (mailType == 1) {
                        this.$http.post("{:url('shop/goods/addCart')}", data,
                            {emulateJSON: true}).then(function (res) {
                            if (res.data.code == 0) {
                                layer.msg(res.data.msg, {shade: [0.2, '#393D49']});
                                $.cookie('cartcount', res.data.data.cartcount, {expires: 365});
                                $.cookie('cartnum', res.data.data.cartnum, {expires: 365});
                                this.cartCount = res.data.data.cartnum;
                                $("#shopcart-num").html(res.data.data.cartcount);
                                this.hideProduct();
                            } else {
                                layer.msg(res.data.msg, {shade: [0.2, '#393D49']});
                            }
                        });
                    } else {
                        var goods_list = data.goods_id + ":" + data.sku_id + ":" + data.num;
                        location.href = "{:url('orderlist')}&goods_list=" + goods_list;
                    }
                },
                gotoStock: function (id) {
                    location.href = "{:url('detail')}" + "&list=" + id;
                },
                showCoupon: function () {
                    $(".coupon-div").fadeIn();
                },
                hideCoupon: function () {
                    $(".coupon-div").fadeOut();

                }
            }
        });

    });

    function specIndex(obj) {
        $(obj).parent("ul").children("li").removeClass("selected").removeClass("icon-filter-checked");
        $(obj).addClass("selected").addClass("icon-filter-checked");
        var arr = $(obj).attr("data-for-index").split("-");
        main.specNum[arr[0]] = arr[1];
        main.getInfo();
    }

    function showAddress() {
        $("#main").hide();
        $("#niu-address").show();
    }
</script>
<!--{include file="index/wxShare"}-->

{include file="index/address_detail"}
</body>
</html>